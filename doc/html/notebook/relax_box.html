
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>relax_box - Methodology and code &#8212; iprPy 0.11.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="relax_dynamic - Methodology and code" href="relax_dynamic.html" />
    <link rel="prev" title="point_defect_static - Methodology and code" href="point_defect_static.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="relax_dynamic.html" title="relax_dynamic - Methodology and code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="point_defect_static.html" title="point_defect_static - Methodology and code"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" accesskey="U">Jupyter Demonstration Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">relax_box - Methodology and code</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="relax_box---Methodology-and-code">
<h1>relax_box - Methodology and code<a class="headerlink" href="#relax_box---Methodology-and-code" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Python imports</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.numpy.org/">numpy</a></p></li>
<li><p><a class="reference external" href="https://ipython.org">IPython</a></p></li>
<li><p><a class="reference external" href="https://github.com/usnistgov/atomman">atomman</a></p></li>
<li><p><a class="reference external" href="https://github.com/usnistgov/iprPy">iprPy</a></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="c1"># http://www.numpy.org/</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># https://ipython.org/</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span>

<span class="c1"># https://github.com/usnistgov/atomman</span>
<span class="kn">import</span> <span class="nn">atomman</span> <span class="k">as</span> <span class="nn">am</span>
<span class="kn">import</span> <span class="nn">atomman.lammps</span> <span class="k">as</span> <span class="nn">lmp</span>
<span class="kn">import</span> <span class="nn">atomman.unitconvert</span> <span class="k">as</span> <span class="nn">uc</span>
<span class="kn">from</span> <span class="nn">atomman.tools</span> <span class="kn">import</span> <span class="n">filltemplate</span>

<span class="c1"># https://github.com/usnistgov/iprPy</span>
<span class="kn">import</span> <span class="nn">iprPy</span>
<span class="kn">from</span> <span class="nn">iprPy.tools</span> <span class="kn">import</span> <span class="n">read_calc_file</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Notebook last executed on&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="s1">&#39;using iprPy version&#39;</span><span class="p">,</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Notebook last executed on 2022-03-07 using iprPy version 0.11.2
</pre></div></div>
</div>
<div class="section" id="1.-Load-calculation-and-view-description">
<h2>1. Load calculation and view description<a class="headerlink" href="#1.-Load-calculation-and-view-description" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="1.1.-Load-the-calculation">
<h3>1.1. Load the calculation<a class="headerlink" href="#1.1.-Load-the-calculation" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load the calculation being demoed</span>
<span class="n">calculation</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">load_calculation</span><span class="p">(</span><span class="s1">&#39;relax_box&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1.2.-Display-calculation-description-and-theory">
<h3>1.2. Display calculation description and theory<a class="headerlink" href="#1.2.-Display-calculation-description-and-theory" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Display main docs and theory</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calculation</span><span class="o">.</span><span class="n">maindoc</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calculation</span><span class="o">.</span><span class="n">theorydoc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="section" id="relax_box-calculation-style">
<h4>relax_box calculation style<a class="headerlink" href="#relax_box-calculation-style" title="Permalink to this headline">Â¶</a></h4>
<p><strong>Lucas M. Hale</strong>, <a class="reference external" href="mailto:lucas&#46;hale&#37;&#52;&#48;nist&#46;gov?Subject=ipr-demo">lucas<span>&#46;</span>hale<span>&#64;</span>nist<span>&#46;</span>gov</a>, <em>Materials Science and Engineering Division, NIST</em>.</p>
<div class="section" id="Introduction">
<h5>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">Â¶</a></h5>
<p>The relax_box calculation style refines the lattice parameters of an orthogonal system (crystal structure) by relaxing the box dimensions towards a given pressure. In refining the lattice parameter values, the box dimensions are allowed to relax, but the relative positions of the atoms within the box are held fixed.</p>
<p>This calculations provides a quick tool for obtaining lattice parameters for ideal crystal structures.</p>
<div class="section" id="Version-notes">
<h6>Version notes<a class="headerlink" href="#Version-notes" title="Permalink to this headline">Â¶</a></h6>
<ul class="simple">
<li><p>2018-07-09: Notebook added.</p></li>
<li><p>2019-07-30: Description updated and small changes due to iprPy version.</p></li>
<li><p>2020-05-22: Version 0.10 update - potentials now loaded from database.</p></li>
<li><p>2020-09-22: Setup and parameter definition streamlined.</p></li>
</ul>
</div>
<div class="section" id="Additional-dependencies">
<h6>Additional dependencies<a class="headerlink" href="#Additional-dependencies" title="Permalink to this headline">Â¶</a></h6>
</div>
<div class="section" id="Disclaimers">
<h6>Disclaimers<a class="headerlink" href="#Disclaimers" title="Permalink to this headline">Â¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="http://www.nist.gov/public_affairs/disclaimer.cfm">NIST disclaimers</a></p></li>
<li><p>With this method there is no guarantee that the resulting parameters are for a stable structure. Allowing internal relaxations may result in different values for some structures. Additionally, some transformation paths may be restricted from occurring due to symmetry, i.e.Â initially cubic structures may remain cubic instead of relaxing to a non-cubic structure.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="section" id="Method-and-Theory">
<h4>Method and Theory<a class="headerlink" href="#Method-and-Theory" title="Permalink to this headline">Â¶</a></h4>
<p>The math in this section uses Voigt notation, where indicies i,j correspond to 1=xx, 2=yy, 3=zz, 4=yz, 5=xz, and 6=xy, and x, y and z are orthogonal box vectors.</p>
<p>An initial system (and corresponding unit cell system) is supplied with box dimensions, <span class="math notranslate nohighlight">\(a_i^0\)</span>, close to the equilibrium values. A LAMMPS simulation is performed that evaluates the systemâs pressures, <span class="math notranslate nohighlight">\(P_{i}\)</span>, for the initial system as given, and subjected to twelve different strain states corresponding to one of <span class="math notranslate nohighlight">\(\epsilon_{i}\)</span> being given a value of <span class="math notranslate nohighlight">\(\frac{\Delta \epsilon}{2}\)</span>, where <span class="math notranslate nohighlight">\(\Delta \epsilon\)</span> is the strain range parameter. Using the <span class="math notranslate nohighlight">\(P_{i}\)</span> values
obtained from the strained states, the <span class="math notranslate nohighlight">\(C_{ij}\)</span> matrix for the system is estimated as</p>
<div class="math notranslate nohighlight">
\[C_{ij} \approx - \frac{P_i(\epsilon_j=\frac{\Delta \epsilon}{2}) - P_i(\epsilon_j=-\frac{\Delta \epsilon}{2})}{\Delta \epsilon}.\]</div>
<p>The negative out front comes from the fact that the system-wide stress state is <span class="math notranslate nohighlight">\(\sigma_i = -P_i\)</span>. Using <span class="math notranslate nohighlight">\(C_{ij}\)</span>, an attempt is made to compute the elastic compliance matrix as <span class="math notranslate nohighlight">\(S_{ij} = C_{ij}^{-1}\)</span>. If successful, new box dimensions are estimated using <span class="math notranslate nohighlight">\(S_{ij}\)</span>, <span class="math notranslate nohighlight">\(a_i^0\)</span>, and <span class="math notranslate nohighlight">\(P_i\)</span> for the unstrained system</p>
<div class="math notranslate nohighlight">
\[a_i = \frac{a_i^0}{1 - (\sum_{j=1}^3{S_{ij} P_j})}.\]</div>
<p>The system is updated using the new box dimensions. The process is repeated until either <span class="math notranslate nohighlight">\(a_i\)</span> converge less than a specified tolerance, <span class="math notranslate nohighlight">\(a_i\)</span> diverge from <span class="math notranslate nohighlight">\(a_i^0\)</span> greater than some limit, or convergence is not reached after 100 iterations. If the calculation is successful, the final <span class="math notranslate nohighlight">\(a_i\)</span> dimensions are reported.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-Define-calculation-functions-and-generate-files">
<h2>2. Define calculation functions and generate files<a class="headerlink" href="#2.-Define-calculation-functions-and-generate-files" title="Permalink to this headline">Â¶</a></h2>
<p>This section defines the calculation functions and associated resource files exactly as they exist inside the iprPy package. This allows for the code used to be directly visible and modifiable by anyone looking to see how it works.</p>
<div class="section" id="2.1.-relax_box()">
<h3>2.1. relax_box()<a class="headerlink" href="#2.1.-relax_box()" title="Permalink to this headline">Â¶</a></h3>
<p>This is the primary function for the calculation. The version of this function built in iprPy can be accessed by calling the calc() method of an object of the associated calculation class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">relax_box</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
              <span class="n">system</span><span class="p">:</span> <span class="n">am</span><span class="o">.</span><span class="n">System</span><span class="p">,</span>
              <span class="n">potential</span><span class="p">:</span> <span class="n">lmp</span><span class="o">.</span><span class="n">Potential</span><span class="p">,</span>
              <span class="n">mpi_command</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">strainrange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
              <span class="n">p_xx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">p_yy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">p_zz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">p_xy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">p_xz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">p_yz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span>
              <span class="n">diverge_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quickly refines static orthorhombic system by evaluating the elastic</span>
<span class="sd">    constants and the virial pressure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lammps_command :str</span>
<span class="sd">        Command for running LAMMPS.</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to perform the calculation on.</span>
<span class="sd">    potential : atomman.lammps.Potential</span>
<span class="sd">        The LAMMPS implemented potential to use.</span>
<span class="sd">    mpi_command : str, optional</span>
<span class="sd">        The MPI command for running LAMMPS in parallel.  If not given, LAMMPS</span>
<span class="sd">        will run serially.</span>
<span class="sd">    strainrange : float, optional</span>
<span class="sd">        The small strain value to apply when calculating the elastic</span>
<span class="sd">        constants (default is 1e-6).</span>
<span class="sd">    p_xx : float, optional</span>
<span class="sd">        The value to relax the x tensile pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    p_yy : float, optional</span>
<span class="sd">        The value to relax the y tensile pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    p_zz : float, optional</span>
<span class="sd">        The value to relax the z tensile pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    p_xy : float, optional</span>
<span class="sd">        The value to relax the xy shear pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    p_xz : float, optional</span>
<span class="sd">        The value to relax the xz shear pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    p_yz : float, optional</span>
<span class="sd">        The value to relax the yz shear pressure component to (default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    tol : float, optional</span>
<span class="sd">        The relative tolerance used to determine if the lattice constants have</span>
<span class="sd">        converged (default is 1e-10).</span>
<span class="sd">    diverge_scale : float, optional</span>
<span class="sd">        Factor to identify if the system&#39;s dimensions have diverged.  Divergence</span>
<span class="sd">        is identified if either any current box dimension is greater than the</span>
<span class="sd">        original dimension multiplied by diverge_scale, or if any current box</span>
<span class="sd">        dimension is less than the original dimension divided by diverge_scale.</span>
<span class="sd">        (Default is 3.0).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of results consisting of keys:</span>

<span class="sd">        - **&#39;dumpfile_initial&#39;** (*str*) - The name of the initial dump file</span>
<span class="sd">          created.</span>
<span class="sd">        - **&#39;symbols_initial&#39;** (*list*) - The symbols associated with the</span>
<span class="sd">          initial dump file.</span>
<span class="sd">        - **&#39;dumpfile_final&#39;** (*str*) - The name of the final dump file</span>
<span class="sd">          created.</span>
<span class="sd">        - **&#39;symbols_final&#39;** (*list*) - The symbols associated with the final</span>
<span class="sd">          dump file.</span>
<span class="sd">        - **&#39;lx&#39;** (*float*) - The relaxed lx box length.</span>
<span class="sd">        - **&#39;ly&#39;** (*float*) - The relaxed ly box length.</span>
<span class="sd">        - **&#39;lz&#39;** (*float*) - The relaxed lz box length.</span>
<span class="sd">        - **&#39;xy&#39;** (*float*) - The relaxed xy box tilt.</span>
<span class="sd">        - **&#39;xz&#39;** (*float*) - The relaxed xz box tilt.</span>
<span class="sd">        - **&#39;yz&#39;** (*float*) - The relaxed yz box tilt.</span>
<span class="sd">        - **&#39;E_pot&#39;** (*float*) - The potential energy per atom for the final</span>
<span class="sd">          configuration.</span>
<span class="sd">        - **&#39;measured_pxx&#39;** (*float*) - The measured x tensile pressure of the</span>
<span class="sd">          relaxed system.</span>
<span class="sd">        - **&#39;measured_pyy&#39;** (*float*) - The measured y tensile pressure of the</span>
<span class="sd">          relaxed system.</span>
<span class="sd">        - **&#39;measured_pzz&#39;** (*float*) - The measured z tensile pressure of the</span>
<span class="sd">          relaxed system.</span>
<span class="sd">        - **&#39;measured_pxy&#39;** (*float*) - The measured xy shear pressure of the</span>
<span class="sd">          relaxed system.</span>
<span class="sd">        - **&#39;measured_pxz&#39;** (*float*) - The measured xz shear pressure of the</span>
<span class="sd">          relaxed system.</span>
<span class="sd">        - **&#39;measured_pyz&#39;** (*float*) - The measured yz shear pressure of the</span>
<span class="sd">          relaxed system.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If system diverges or no convergence reached after 100 cycles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Flag for if values have converged</span>
    <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Define current and old systems</span>
    <span class="n">system_current</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">system_old</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">system</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;atom_dump&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s1">&#39;initial.dump&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>

        <span class="c1"># Run LAMMPS and evaluate results based on system_old</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cij_run0</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system_current</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                           <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span> <span class="n">strainrange</span><span class="o">=</span><span class="n">strainrange</span><span class="p">,</span>
                           <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">)</span>
        <span class="n">pij</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">]</span>
        <span class="n">Cij</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Cij</span>
        <span class="n">system_new</span> <span class="o">=</span> <span class="n">update_box</span><span class="p">(</span><span class="n">system_current</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">],</span>
                                <span class="n">p_xx</span><span class="p">,</span> <span class="n">p_yy</span><span class="p">,</span> <span class="n">p_zz</span><span class="p">,</span> <span class="n">p_xy</span><span class="p">,</span> <span class="n">p_xz</span><span class="p">,</span> <span class="n">p_yz</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

        <span class="c1"># Compare new and current to test for convergence</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="p">,</span>
                       <span class="n">system_current</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="p">,</span>
                       <span class="n">rtol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

        <span class="c1"># Compare old and new to test for double-value convergence</span>
        <span class="k">elif</span> <span class="n">system_old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="p">,</span>
                                                    <span class="n">system_old</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="p">,</span>
                                                    <span class="n">rtol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

            <span class="c1"># Update current to average of old and new</span>
            <span class="n">system_current</span><span class="o">.</span><span class="n">box_set</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="n">system_old</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                   <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span><span class="o">+</span><span class="n">system_old</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                   <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span><span class="o">+</span><span class="n">system_old</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                   <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Calculate Cij for the averaged system</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">cij_run0</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system_current</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                               <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span> <span class="n">strainrange</span><span class="o">=</span><span class="n">strainrange</span><span class="p">,</span>
                               <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">)</span>
            <span class="n">system_new</span> <span class="o">=</span> <span class="n">update_box</span><span class="p">(</span><span class="n">system_current</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">],</span>
                                    <span class="n">p_xx</span><span class="p">,</span> <span class="n">p_yy</span><span class="p">,</span> <span class="n">p_zz</span><span class="p">,</span> <span class="n">p_xy</span><span class="p">,</span> <span class="n">p_xz</span><span class="p">,</span> <span class="n">p_yz</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

        <span class="c1"># Test for divergence</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span> <span class="o">&lt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">diverge_scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence: potential energy is 0&#39;</span><span class="p">)</span>

        <span class="c1"># If not converged or diverged, current -&gt; old and new -&gt; current</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">system_old</span><span class="p">,</span> <span class="n">system_current</span> <span class="o">=</span> <span class="n">system_current</span><span class="p">,</span> <span class="n">system_new</span>

    <span class="c1"># Return values when converged</span>
    <span class="k">if</span> <span class="n">converged</span><span class="p">:</span>
        <span class="n">system_new</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;atom_dump&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s1">&#39;final.dump&#39;</span><span class="p">)</span>

        <span class="c1"># Build results_dict</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile_initial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;initial.dump&#39;</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;symbols_initial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">symbols</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;final.dump&#39;</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;symbols_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">symbols</span>

        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lx</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;ly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ly</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;lz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;xz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xz</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;yz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_new</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">yz</span>

        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pyy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pzz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">results_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Failed to converge after 100 cycles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.2.-cij_run0()">
<h3>2.2. cij_run0()<a class="headerlink" href="#2.2.-cij_run0()" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cij_run0</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">system</span><span class="p">:</span> <span class="n">am</span><span class="o">.</span><span class="n">System</span><span class="p">,</span>
             <span class="n">potential</span><span class="p">:</span> <span class="n">lmp</span><span class="o">.</span><span class="n">Potential</span><span class="p">,</span>
             <span class="n">mpi_command</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">strainrange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
             <span class="n">cycle</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs cij_run0.in LAMMPS script to evaluate the elastic constants,</span>
<span class="sd">    pressure and potential energy of the current system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lammps_command :str</span>
<span class="sd">        Command for running LAMMPS.</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to perform the calculation on.</span>
<span class="sd">    potential : atomman.lammps.Potential</span>
<span class="sd">        The LAMMPS implemented potential to use.</span>
<span class="sd">    mpi_command : str, optional</span>
<span class="sd">        The MPI command for running LAMMPS in parallel.  If not given, LAMMPS</span>
<span class="sd">        will run serially.</span>
<span class="sd">    strainrange : float, optional</span>
<span class="sd">        The small strain value to apply when calculating the elastic</span>
<span class="sd">        constants (default is 1e-6).</span>
<span class="sd">    cycle : int, optional</span>
<span class="sd">        Indicates the iteration cycle of quick_a_Cij().  This is used to</span>
<span class="sd">        uniquely save the LAMMPS input and output files.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of results consisting of keys:</span>

<span class="sd">        - **&#39;E_pot&#39;** (*float*) - The potential energy per atom for the</span>
<span class="sd">          supplied system.</span>
<span class="sd">        - **&#39;pressure&#39;** (*numpy.array*) - The measured pressure state of the</span>
<span class="sd">          supplied system.</span>
<span class="sd">        - **&#39;C_elastic&#39;** (*atomman.ElasticConstants*) - The supplied system&#39;s</span>
<span class="sd">          elastic constants.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get lammps units</span>
    <span class="n">lammps_units</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">unit</span><span class="p">(</span><span class="n">potential</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

    <span class="c1"># Define lammps variables</span>
    <span class="n">lammps_variables</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">system_info</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;atom_data&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s1">&#39;init.dat&#39;</span><span class="p">,</span>
                              <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">)</span>
    <span class="n">restart_info</span> <span class="o">=</span> <span class="n">potential</span><span class="o">.</span><span class="n">pair_restart_info</span><span class="p">(</span><span class="s1">&#39;initial.restart&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;pair_data_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_info</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;pair_restart_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restart_info</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;strainrange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strainrange</span>

    <span class="c1"># Write lammps input script</span>
    <span class="n">lammps_script</span> <span class="o">=</span> <span class="s1">&#39;cij_run0.in&#39;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">read_calc_file</span><span class="p">(</span><span class="s1">&#39;iprPy.calculation.relax_box&#39;</span><span class="p">,</span> <span class="s1">&#39;cij_run0.template&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filltemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">lammps_variables</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">))</span>

    <span class="c1"># Run lammps</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">script_name</span><span class="o">=</span><span class="n">lammps_script</span><span class="p">,</span>
                     <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span>
                     <span class="n">logfile</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cij-</span><span class="si">{</span><span class="n">cycle</span><span class="si">}</span><span class="s1">-log.lammps&#39;</span><span class="p">)</span>
    <span class="n">thermo</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">thermo</span>

    <span class="c1"># Extract LAMMPS thermo data. Each term ranges i=0-12 where i=0 is undeformed</span>
    <span class="c1"># The remaining values are for -/+ strain pairs in the six unique directions</span>
    <span class="n">lx</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Lx</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>
    <span class="n">ly</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Ly</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>
    <span class="n">lz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Lz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Xy</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Xz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>
    <span class="n">yz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Yz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>

    <span class="n">pxx</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pxx</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">pyy</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pyy</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">pzz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pzz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">pxy</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pxy</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">pxz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pxz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">pyz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">Pyz</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>

    <span class="n">pe</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">PotEng</span> <span class="o">/</span> <span class="n">system</span><span class="o">.</span><span class="n">natoms</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>

    <span class="c1"># Extract the pressure tensor</span>
    <span class="n">pij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">pxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pxz</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">pxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pyy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">pxz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pzz</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>

    <span class="c1"># Set the six non-zero strain values</span>
    <span class="n">strains</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">lx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span>  <span class="n">lx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="o">/</span> <span class="n">lx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">(</span><span class="n">ly</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span>  <span class="n">ly</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="o">/</span> <span class="n">ly</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">(</span><span class="n">lz</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span>  <span class="n">lz</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="o">/</span> <span class="n">lz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">(</span><span class="n">yz</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span>  <span class="n">yz</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>  <span class="o">/</span> <span class="n">lz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">(</span><span class="n">xz</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">xz</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>  <span class="o">/</span> <span class="n">lz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">/</span> <span class="n">ly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>

    <span class="c1"># Calculate cij using stress changes associated with each non-zero strain</span>
    <span class="n">cij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">delta_stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">pxx</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pxx</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">pyy</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pyy</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">pzz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pzz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">pyz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pyz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">pxz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pxz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">pxy</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pxy</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>

        <span class="n">cij</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_stress</span> <span class="o">/</span> <span class="n">strains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">cij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cij</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">cij</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">ElasticConstants</span><span class="p">(</span><span class="n">Cij</span><span class="o">=</span><span class="n">cij</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;pij&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pij</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.3.-update_box()">
<h3>2.3. update_box()<a class="headerlink" href="#2.3.-update_box()" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">update_box</span><span class="p">(</span><span class="n">system</span><span class="p">:</span> <span class="n">am</span><span class="o">.</span><span class="n">System</span><span class="p">,</span>
               <span class="n">C</span><span class="p">:</span> <span class="n">am</span><span class="o">.</span><span class="n">ElasticConstants</span><span class="p">,</span>
               <span class="n">pij</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
               <span class="n">target_pxx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">target_pyy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">target_pzz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">target_pxy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">target_pxz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">target_pyz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
               <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">am</span><span class="o">.</span><span class="n">System</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a new system with an updated box that attempts to reach the target</span>
<span class="sd">    pressure. The new box dimensions are estimated by assuming linear elasticity</span>
<span class="sd">    and using the pressure and elastic constants of the current system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to update</span>
<span class="sd">    C : atomman.ElasticConstants</span>
<span class="sd">        The computed elastic constants for the system.</span>
<span class="sd">    pij : numpy.NDArray</span>
<span class="sd">        The 3x3 array of pressure tensors computed for the system.</span>
<span class="sd">    target_pxx : float, optional</span>
<span class="sd">        The value to relax the x tensile pressure component to. Default is</span>
<span class="sd">        0.0.</span>
<span class="sd">    target_pyy : float, optional</span>
<span class="sd">        The value to relax the y tensile pressure component to. Default is</span>
<span class="sd">        0.0.</span>
<span class="sd">    target_pzz : float, optional</span>
<span class="sd">        The value to relax the z tensile pressure component to. Default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    target_pyz : float, optional</span>
<span class="sd">        The value to relax the yz shear pressure component to. Default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    target_pxz : float, optional</span>
<span class="sd">        The value to relax the xz shear pressure component to. Default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    target_pyz : float, optional</span>
<span class="sd">        The value to relax the xy shear pressure component to. Default is</span>
<span class="sd">        0.0).</span>
<span class="sd">    tol : float, optional</span>
<span class="sd">        The target tolerance.  Any strains less than this will be ignored.</span>
<span class="sd">        Default value is 1e-10.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    atomman.System</span>
<span class="sd">        The System with updated box dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Build the target pij array</span>
    <span class="n">target_pij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">target_pxx</span><span class="p">,</span> <span class="n">target_pxy</span><span class="p">,</span> <span class="n">target_pxz</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">target_pxy</span><span class="p">,</span> <span class="n">target_pyy</span><span class="p">,</span> <span class="n">target_pyz</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">target_pxz</span><span class="p">,</span> <span class="n">target_pyz</span><span class="p">,</span> <span class="n">target_pzz</span><span class="p">]])</span>

    <span class="c1"># Adjust pij by the target</span>
    <span class="n">pij</span> <span class="o">=</span> <span class="n">pij</span> <span class="o">-</span> <span class="n">target_pij</span>

    <span class="c1"># The stress state is the negative of the pressure state</span>
    <span class="n">Ïij</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pij</span>

    <span class="c1"># Compute the strain associated with the system relative to the target</span>
    <span class="n">Ïµij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,kl-&gt;ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">Sijkl</span><span class="p">,</span> <span class="n">Ïij</span><span class="p">)</span>
    <span class="n">Ïµij</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ïµij</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Compute new box dimensions by removing the strain</span>
    <span class="n">lx</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lx</span> <span class="o">-</span> <span class="n">Ïµij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lx</span>
    <span class="n">ly</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ly</span> <span class="o">-</span> <span class="n">Ïµij</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ly</span>
    <span class="n">lz</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span> <span class="o">-</span> <span class="n">Ïµij</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span>
    <span class="n">yz</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">yz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ïµij</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ïµij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ïµij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ly</span>

    <span class="k">if</span> <span class="n">lx</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">ly</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">lz</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Divergence of box dimensions to &lt;= 0&#39;</span><span class="p">)</span>

    <span class="c1"># Duplicate system and change dimensions</span>
    <span class="n">system_new</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">system_new</span><span class="o">.</span><span class="n">box_set</span><span class="p">(</span><span class="n">lx</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="o">=</span><span class="n">ly</span><span class="p">,</span> <span class="n">lz</span><span class="o">=</span><span class="n">lz</span><span class="p">,</span> <span class="n">yz</span><span class="o">=</span><span class="n">yz</span><span class="p">,</span> <span class="n">xz</span><span class="o">=</span><span class="n">xz</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">system_new</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">system_new</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.4.-cij_run0.template-file">
<h3>2.4. cij_run0.template file<a class="headerlink" href="#2.4.-cij_run0.template-file" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cij_run0.template&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;# Evaluates P and Cij using small strains to guess how to relax the box.</span>
<span class="s2"># NOTE: Cij predictions may be poor for some crystal structures: use</span>
<span class="s2"># elastic_constants_static calculation instead.</span>

<span class="s2">box tilt large</span>

<span class="s2">&lt;pair_data_info&gt;</span>

<span class="s2">change_box all triclinic</span>

<span class="s2"># Specify strain</span>
<span class="s2">variable strain equal &lt;strainrange&gt;</span>

<span class="s2"># Specify variables of the initial configuration&#39;s dimensions</span>
<span class="s2">variable lx0 equal $(lx)</span>
<span class="s2">variable ly0 equal $(ly)</span>
<span class="s2">variable lz0 equal $(lz)</span>

<span class="s2"># Specify the thermo properties to calculate</span>
<span class="s2">variable peatom equal pe/atoms</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Evaluate and save the initial configuration</span>
<span class="s2">run 0</span>
<span class="s2">write_restart initial.restart</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -xx strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lx0}</span><span class="s2"></span>
<span class="s2">change_box all x delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +xx strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lx0}</span><span class="s2"></span>
<span class="s2">change_box all x delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -yy strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{ly0}</span><span class="s2"></span>
<span class="s2">change_box all y delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +yy strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{ly0}</span><span class="s2"></span>
<span class="s2">change_box all y delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -zz strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all z delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +zz strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all z delta 0 $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -yz strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all yz delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +yz strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all yz delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -xz strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all xz delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +xz strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{lz0}</span><span class="s2"></span>
<span class="s2">change_box all xz delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply -xy strain</span>
<span class="s2">variable delta equal -$</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{ly0}</span><span class="s2"></span>
<span class="s2">change_box all xy delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0</span>

<span class="s2"># Reset simulation</span>
<span class="s2">clear</span>
<span class="s2">box tilt large</span>
<span class="s2">&lt;pair_restart_info&gt;</span>
<span class="s2">thermo_style custom step lx ly lz yz xz xy pxx pyy pzz pyz pxz pxy v_peatom pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>


<span class="s2"># Apply +xy strain</span>
<span class="s2">variable delta equal $</span><span class="si">{strain}</span><span class="s2">*$</span><span class="si">{ly0}</span><span class="s2"></span>
<span class="s2">change_box all xy delta $</span><span class="si">{delta}</span><span class="s2"> remap units box</span>
<span class="s2">run 0&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="3.-Specify-input-parameters">
<h2>3. Specify input parameters<a class="headerlink" href="#3.-Specify-input-parameters" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="3.1.-System-specific-paths">
<h3>3.1. System-specific paths<a class="headerlink" href="#3.1.-System-specific-paths" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p><strong>lammps_command</strong> is the LAMMPS command to use (required).</p></li>
<li><p><strong>mpi_command</strong> MPI command for running LAMMPS in parallel. A value of None will run simulations serially.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;lmp_serial&#39;</span>
<span class="n">mpi_command</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.2.-Interatomic-potential">
<h3>3.2. Interatomic potential<a class="headerlink" href="#3.2.-Interatomic-potential" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p><strong>potential_name</strong> gives the name of the potential_LAMMPS reference record in the iprPy library to use for the calculation.</p></li>
<li><p><strong>potential</strong> is an atomman.lammps.Potential object (required).</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">potential_name</span> <span class="o">=</span> <span class="s1">&#39;1999--Mishin-Y--Ni--LAMMPS--ipr1&#39;</span>

<span class="c1"># Retrieve potential and parameter file(s) using atomman</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load_lammps_potential</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">potential_name</span><span class="p">,</span> <span class="n">getfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.3.-Initial-unit-cell-system">
<h3>3.3. Initial unit cell system<a class="headerlink" href="#3.3.-Initial-unit-cell-system" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p><strong>ucell</strong> is an atomman.System representing a fundamental unit cell of the system (required). Here, this is generated using the load parameters and symbols.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create ucell by loading prototype record</span>
<span class="n">ucell</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;prototype&#39;</span><span class="p">,</span> <span class="s1">&#39;A1--Cu--fcc&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
avect =  [ 3.500,  0.000,  0.000]
bvect =  [ 0.000,  3.500,  0.000]
cvect =  [ 0.000,  0.000,  3.500]
origin = [ 0.000,  0.000,  0.000]
natoms = 4
natypes = 1
symbols = (&#39;Ni&#39;,)
pbc = [ True  True  True]
per-atom properties = [&#39;atype&#39;, &#39;pos&#39;]
     id |   atype |  pos[0] |  pos[1] |  pos[2]
      0 |       1 |   0.000 |   0.000 |   0.000
      1 |       1 |   0.000 |   1.750 |   1.750
      2 |       1 |   1.750 |   0.000 |   1.750
      3 |       1 |   1.750 |   1.750 |   0.000
</pre></div></div>
</div>
</div>
<div class="section" id="3.4.-System-modifications">
<h3>3.4. System modifications<a class="headerlink" href="#3.4.-System-modifications" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p><strong>sizemults</strong> list of three integers specifying how many times the ucell vectors of <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(c\)</span> are replicated in creating system.</p></li>
<li><p><strong>system</strong> is an atomman.System to perform the scan on (required).</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sizemults</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># Generate system by supersizing ucell</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ucell</span><span class="o">.</span><span class="n">supersize</span><span class="p">(</span><span class="o">*</span><span class="n">sizemults</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of atoms in system =&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">natoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# of atoms in system = 108
</pre></div></div>
</div>
</div>
<div class="section" id="3.5.-Calculation-specific-parameters">
<h3>3.5. Calculation-specific parameters<a class="headerlink" href="#3.5.-Calculation-specific-parameters" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p><strong>strainrange</strong> specifies the <span class="math notranslate nohighlight">\(\Delta \epsilon\)</span> strain range to use in estimating <span class="math notranslate nohighlight">\(C_{ij}\)</span>.</p></li>
<li><p><strong>pressure_xx</strong> gives the xx component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>pressure_yy</strong> gives the yy component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>pressure_zz</strong> gives the zz component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>pressure_xy</strong> gives the xy component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>pressure_xz</strong> gives the xz component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>pressure_yz</strong> gives the yz component of the pressure to equilibriate the system to.</p></li>
<li><p><strong>convergence_tol</strong> is the relative tolerance to use in identifying if the lattice constants have converged.</p></li>
<li><p><strong>divergence_scale</strong> is a factor for identifying if the lattice constants have diverged from the original guess. Divergence is identified if <span class="math notranslate nohighlight">\(a &gt; a^0 d\)</span> or <span class="math notranslate nohighlight">\(a &lt; a^0 / d\)</span>, where d is divergence_scale.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">strainrange</span> <span class="o">=</span> <span class="mf">1e-7</span>
<span class="n">pressure_xx</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">pressure_yy</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">pressure_zz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">pressure_xy</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">pressure_xz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">pressure_yz</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">convergence_tol</span> <span class="o">=</span> <span class="mf">1e-11</span>
<span class="n">divergence_scale</span> <span class="o">=</span> <span class="mf">3.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="4.-Run-calculation-and-view-results">
<h2>4. Run calculation and view results<a class="headerlink" href="#4.-Run-calculation-and-view-results" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="4.1.-Run-calculation">
<h3>4.1. Run calculation<a class="headerlink" href="#4.1.-Run-calculation" title="Permalink to this headline">Â¶</a></h3>
<p>All primary calculation method functions take a series of inputs and return a dictionary of outputs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="n">relax_box</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                         <span class="n">mpi_command</span> <span class="o">=</span> <span class="n">mpi_command</span><span class="p">,</span>
                         <span class="n">p_xx</span> <span class="o">=</span> <span class="n">pressure_xx</span><span class="p">,</span>
                         <span class="n">p_yy</span> <span class="o">=</span> <span class="n">pressure_yy</span><span class="p">,</span>
                         <span class="n">p_zz</span> <span class="o">=</span> <span class="n">pressure_zz</span><span class="p">,</span>
                         <span class="n">p_xy</span> <span class="o">=</span> <span class="n">pressure_xy</span><span class="p">,</span>
                         <span class="n">p_xz</span> <span class="o">=</span> <span class="n">pressure_xz</span><span class="p">,</span>
                         <span class="n">p_yz</span> <span class="o">=</span> <span class="n">pressure_yz</span><span class="p">,</span>
                         <span class="n">strainrange</span> <span class="o">=</span> <span class="n">strainrange</span><span class="p">,</span>
                         <span class="n">tol</span> <span class="o">=</span> <span class="n">convergence_tol</span><span class="p">,</span>
                         <span class="n">diverge_scale</span> <span class="o">=</span> <span class="n">divergence_scale</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;dumpfile_initial&#39;, &#39;symbols_initial&#39;, &#39;dumpfile_final&#39;, &#39;symbols_final&#39;, &#39;lx&#39;, &#39;ly&#39;, &#39;lz&#39;, &#39;xy&#39;, &#39;xz&#39;, &#39;yz&#39;, &#39;E_pot&#39;, &#39;measured_pxx&#39;, &#39;measured_pyy&#39;, &#39;measured_pzz&#39;, &#39;measured_pxy&#39;, &#39;measured_pxz&#39;, &#39;measured_pyz&#39;])
</pre></div></div>
</div>
</div>
<div class="section" id="4.2.-Report-results">
<h3>4.2. Report results<a class="headerlink" href="#4.2.-Report-results" title="Permalink to this headline">Â¶</a></h3>
<p>Values returned in the results_dict:</p>
<ul class="simple">
<li><p><strong>âdumpfile_initialâ</strong> (<em>str</em>) - The name of the initial dump file created.</p></li>
<li><p><strong>âsymbols_initialâ</strong> (<em>list</em>) - The symbols associated with the initial dump file.</p></li>
<li><p><strong>âdumpfile_finalâ</strong> (<em>str</em>) - The name of the final dump file created.</p></li>
<li><p><strong>âsymbols_finalâ</strong> (<em>list</em>) - The symbols associated with the final dump file.</p></li>
<li><p><strong>âlxâ</strong> (<em>float</em>) - The relaxed lx box length.</p></li>
<li><p><strong>âlyâ</strong> (<em>float</em>) - The relaxed ly box length.</p></li>
<li><p><strong>âlzâ</strong> (<em>float</em>) - The relaxed lz box length.</p></li>
<li><p><strong>âxyâ</strong> (<em>float</em>) - The relaxed xy box tilt.</p></li>
<li><p><strong>âxzâ</strong> (<em>float</em>) - The relaxed xz box tilt.</p></li>
<li><p><strong>âyzâ</strong> (<em>float</em>) - The relaxed yz box tilt.</p></li>
<li><p><strong>âE_potâ</strong> (<em>float</em>) - The potential energy per atom for the final configuration.</p></li>
<li><p><strong>âmeasured_pxxâ</strong> (<em>float</em>) - The measured x tensile pressure of the relaxed system.</p></li>
<li><p><strong>âmeasured_pyyâ</strong> (<em>float</em>) - The measured y tensile pressure of the relaxed system.</p></li>
<li><p><strong>âmeasured_pzzâ</strong> (<em>float</em>) - The measured z tensile pressure of the relaxed system.</p></li>
<li><p><strong>âmeasured_pxyâ</strong> (<em>float</em>) - The measured xy shear pressure of the relaxed system.</p></li>
<li><p><strong>âmeasured_pxzâ</strong> (<em>float</em>) - The measured xz shear pressure of the relaxed system.</p></li>
<li><p><strong>âmeasured_pyzâ</strong> (<em>float</em>) - The measured yz shear pressure of the relaxed system.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Show initial and final dump files</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile_initial&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;symbols_initial&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile_final&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;symbols_final&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
initial.dump
(&#39;Ni&#39;,)
final.dump
(&#39;Ni&#39;,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">length_unit</span> <span class="o">=</span> <span class="s1">&#39;angstrom&#39;</span>
<span class="n">energy_unit</span> <span class="o">=</span> <span class="s1">&#39;eV&#39;</span>

<span class="c1"># Show the per atom potential energy</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E_pot =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">],</span> <span class="n">energy_unit</span><span class="p">),</span> <span class="n">energy_unit</span><span class="p">)</span>

<span class="c1"># Construct a Box from the returned system dimensions</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">lx</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">],</span> <span class="n">ly</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;ly&#39;</span><span class="p">],</span> <span class="n">lz</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;lz&#39;</span><span class="p">],</span>
             <span class="n">xy</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">],</span> <span class="n">xz</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;xz&#39;</span><span class="p">],</span> <span class="n">yz</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;yz&#39;</span><span class="p">])</span>

<span class="c1"># Retrieve lattice constants by dividing by sizemults</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length_unit</span><span class="p">),</span> <span class="n">length_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">length_unit</span><span class="p">),</span> <span class="n">length_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">length_unit</span><span class="p">),</span> <span class="n">length_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alpha =&#39;</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;beta = &#39;</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gamma =&#39;</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
E_pot = -4.449999998349075 eV
a = 3.5199994375403096 angstrom
b = 3.5199994375393544 angstrom
c = 3.51999943754031 angstrom
alpha = 90.0
beta =  90.0
gamma = 90.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pressure_unit</span> <span class="o">=</span> <span class="s1">&#39;GPa&#39;</span>

<span class="c1"># Show the computed pressure tensor</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pxx =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxx&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pyy =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pyy&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pzz =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pzz&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pyz =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pyz&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pxz =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxz&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pxy =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_pxy&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pxx = 5.906324177712e-11 GPa
Pyy = 8.558944732238101e-11 GPa
Pzz = 5.90657058274e-11 GPa
Pyz = 1.1234558746604e-15 GPa
Pxz = 1.7654306601807003e-15 GPa
Pxy = 4.8148108914018e-16 GPa
</pre></div></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">relax_box - Methodology and code</a><ul>
<li><a class="reference internal" href="#1.-Load-calculation-and-view-description">1. Load calculation and view description</a><ul>
<li><a class="reference internal" href="#1.1.-Load-the-calculation">1.1. Load the calculation</a></li>
<li><a class="reference internal" href="#1.2.-Display-calculation-description-and-theory">1.2. Display calculation description and theory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Define-calculation-functions-and-generate-files">2. Define calculation functions and generate files</a><ul>
<li><a class="reference internal" href="#2.1.-relax_box()">2.1. relax_box()</a></li>
<li><a class="reference internal" href="#2.2.-cij_run0()">2.2. cij_run0()</a></li>
<li><a class="reference internal" href="#2.3.-update_box()">2.3. update_box()</a></li>
<li><a class="reference internal" href="#2.4.-cij_run0.template-file">2.4. cij_run0.template file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Specify-input-parameters">3. Specify input parameters</a><ul>
<li><a class="reference internal" href="#3.1.-System-specific-paths">3.1. System-specific paths</a></li>
<li><a class="reference internal" href="#3.2.-Interatomic-potential">3.2. Interatomic potential</a></li>
<li><a class="reference internal" href="#3.3.-Initial-unit-cell-system">3.3. Initial unit cell system</a></li>
<li><a class="reference internal" href="#3.4.-System-modifications">3.4. System modifications</a></li>
<li><a class="reference internal" href="#3.5.-Calculation-specific-parameters">3.5. Calculation-specific parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4.-Run-calculation-and-view-results">4. Run calculation and view results</a><ul>
<li><a class="reference internal" href="#4.1.-Run-calculation">4.1. Run calculation</a></li>
<li><a class="reference internal" href="#4.2.-Report-results">4.2. Report results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="point_defect_static.html"
                          title="previous chapter">point_defect_static - Methodology and code</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="relax_dynamic.html"
                          title="next chapter">relax_dynamic - Methodology and code</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="relax_dynamic.html" title="relax_dynamic - Methodology and code"
             >next</a> |</li>
        <li class="right" >
          <a href="point_defect_static.html" title="point_defect_static - Methodology and code"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" >Jupyter Demonstration Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">relax_box - Methodology and code</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>