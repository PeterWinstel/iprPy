<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>relax_liquid - Methodology and code &#8212; iprPy 0.11.6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=2a422f08" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=a2f1e6c4"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="relax_static - Methodology and code" href="relax_static.html" />
    <link rel="prev" title="relax_dynamic - Methodology and code" href="relax_dynamic.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="relax_static.html" title="relax_static - Methodology and code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="relax_dynamic.html" title="relax_dynamic - Methodology and code"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" accesskey="U">Jupyter Demonstration Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">relax_liquid - Methodology and code</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="relax_liquid---Methodology-and-code">
<h1>relax_liquid - Methodology and code<a class="headerlink" href="#relax_liquid---Methodology-and-code" title="Permalink to this heading">¶</a></h1>
<p><strong>Python imports</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.numpy.org/">numpy</a></p></li>
<li><p><a class="reference external" href="https://ipython.org">IPython</a></p></li>
<li><p><a class="reference external" href="https://github.com/usnistgov/atomman">atomman</a></p></li>
<li><p><a class="reference external" href="https://github.com/usnistgov/iprPy">iprPy</a></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># http://www.numpy.org/</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># https://ipython.org/</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># https://github.com/usnistgov/atomman</span>
<span class="kn">import</span> <span class="nn">atomman</span> <span class="k">as</span> <span class="nn">am</span>
<span class="kn">import</span> <span class="nn">atomman.lammps</span> <span class="k">as</span> <span class="nn">lmp</span>
<span class="kn">import</span> <span class="nn">atomman.unitconvert</span> <span class="k">as</span> <span class="nn">uc</span>
<span class="kn">from</span> <span class="nn">atomman.tools</span> <span class="kn">import</span> <span class="n">filltemplate</span>

<span class="c1"># https://github.com/usnistgov/iprPy</span>
<span class="kn">import</span> <span class="nn">iprPy</span>
<span class="kn">from</span> <span class="nn">iprPy.tools</span> <span class="kn">import</span> <span class="n">read_calc_file</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Notebook last executed on&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="s1">&#39;using iprPy version&#39;</span><span class="p">,</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Notebook last executed on 2022-10-17 using iprPy version 0.11.4
</pre></div></div>
</div>
<section id="1.-Load-calculation-and-view-description">
<h2>1. Load calculation and view description<a class="headerlink" href="#1.-Load-calculation-and-view-description" title="Permalink to this heading">¶</a></h2>
<section id="1.1.-Load-the-calculation">
<h3>1.1. Load the calculation<a class="headerlink" href="#1.1.-Load-the-calculation" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the calculation being demoed</span>
<span class="n">calculation</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">load_calculation</span><span class="p">(</span><span class="s1">&#39;relax_liquid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="1.2.-Display-calculation-description-and-theory">
<h3>1.2. Display calculation description and theory<a class="headerlink" href="#1.2.-Display-calculation-description-and-theory" title="Permalink to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display main docs and theory</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calculation</span><span class="o">.</span><span class="n">maindoc</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calculation</span><span class="o">.</span><span class="n">theorydoc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="relax_liquid-calculation-style">
<h4>relax_liquid calculation style<a class="headerlink" href="#relax_liquid-calculation-style" title="Permalink to this heading">¶</a></h4>
<p><strong>Lucas M. Hale</strong>, <a class="reference external" href="mailto:lucas&#46;hale&#37;&#52;&#48;nist&#46;gov?Subject=ipr-demo">lucas<span>&#46;</span>hale<span>&#64;</span>nist<span>&#46;</span>gov</a>, <em>Materials Science and Engineering Division, NIST</em>.</p>
<section id="Introduction">
<h5>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">¶</a></h5>
<p>The relax_liquid calculation style is designed to generate and characterize a liquid phase configuration for an atomic potential based on an initial configuration, target temperature and target pressure. The calculation involves multiple stages of relaxation and computes the mean squared displacement and radial distribution functions on the final liquid.</p>
<section id="Version-notes">
<h6>Version notes<a class="headerlink" href="#Version-notes" title="Permalink to this heading">¶</a></h6>
<ul class="simple">
<li><p>2022-10-??: Calculation created</p></li>
</ul>
</section>
<section id="Additional-dependencies">
<h6>Additional dependencies<a class="headerlink" href="#Additional-dependencies" title="Permalink to this heading">¶</a></h6>
</section>
<section id="Disclaimers">
<h6>Disclaimers<a class="headerlink" href="#Disclaimers" title="Permalink to this heading">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="http://www.nist.gov/public_affairs/disclaimer.cfm">NIST disclaimers</a></p></li>
<li><p>No active checks are performed by this calculation to ensure that the system is liquid. Be sure to check the final atomic configurations. The thermo output can also provide a rough guideline in that you should see convergence of volume but not of the individual lx, ly, lz dimensions for a liquid phase.</p></li>
<li><p>If starting with a crystalline configuration, be sure to use an adequately high melt temperature and number of melt steps.</p></li>
<li><p>The temperature and volume equilibrium stages are designed to get the final nve system close to the target temperature and pressure, but they will not be exact. Be sure to check that the measured temperature and pressure are close to the targets.</p></li>
</ul>
</section>
</section>
</section>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<section id="Method-and-Theory">
<h4>Method and Theory<a class="headerlink" href="#Method-and-Theory" title="Permalink to this heading">¶</a></h4>
<p>This performs five stages of simulations to create and analyze a liquid phase at a given temperature and pressure.</p>
<ol class="arabic simple">
<li><p>A “melt” stage is performed using npt at the target pressure and an elevated melt temperature.</p></li>
<li><p>A “cooling” stage is performed using npt in which the temperature is linearly reduced from the melt to the target temperature.</p></li>
<li><p>A “volume equilibrium” stage is performed using npt at the target temperature and pressure. Following the run, the system’s dimensions are equally scaled to the average volume.</p></li>
<li><p>A “temperature equilibrium” stage is performed using nvt at the target temperature. Following the run, the atomic velocities are scaled based on the expected total energy at the target temperature.</p></li>
<li><p>An “nve analysis” stage is performed in which the mean squared displacements of the atoms and the radial distribution function are measured.</p></li>
</ol>
<section id="Melt-stage">
<h5>Melt stage<a class="headerlink" href="#Melt-stage" title="Permalink to this heading">¶</a></h5>
<p>The melt stage subjects the initial configuration to an npt simulation at the elevated melt temperature. This stage is meant to transform initially crystalline system configurations into amorphous liquid phases. As such, the melt temperature should be much higher than the melting temperature of the initial crystal, and the number of MD steps during this stage should be sufficiently high to allow for the phase transformation to occur.</p>
<p>If the initial atomic configuration is already amorphous, this stage can be skipped by setting meltsteps = 0. Also, if the initial configuration already has velocities assigned to the atoms, you can use those velocities by setting createvelocities = False. These two options make it possible to run a single melt simulation that can be used as the basis for all target temperatures. Note that createvelocities = True is needed if you want to measure statistical error from multiple runs.</p>
</section>
<section id="Cooling-stage">
<h5>Cooling stage<a class="headerlink" href="#Cooling-stage" title="Permalink to this heading">¶</a></h5>
<p>The cooling stage runs npt and linearly scales the temperature from the melt temperature to the target temperature. The larger the number of coolsteps, the more gradual the change from melt to target temperatures will be. This can be important if the target temperature is much smaller than the melt temperature.</p>
<p>Similarly to the melt stage, this stage can be skipped by setting coolsteps = 0. If meltsteps = coolsteps = 0 and createvelocities = True, the atomic velocities will be created for the system at the target temperature rather than the melt temperature. This allows for a generic amorphous state to be used as the starting configuration.</p>
</section>
<section id="Volume-equilibration-stage">
<h5>Volume equilibration stage<a class="headerlink" href="#Volume-equilibration-stage" title="Permalink to this heading">¶</a></h5>
<p>The volume equilibration stage runs npt at the target temperature and pressure. It is meant to allow for the system to equilibrate at the target temperature, then to obtain a time-averaged measurement of the system’s volume. The average volume is computed from a specified number of samples (volrelaxsamples) taken every 100 timesteps from the end of this stage. The max value allowed for volrelaxsamples is volrelaxsteps / 100, but practically it should be noticeably smaller than this to ignore
measurements at the beginning of the stage where the system has not yet equilibrated.</p>
<p>When this stage finishes, the volume of the configuration cell is adjusted to the average volume computed by scaling each box length and tilt by the same factor, s</p>
<div class="math notranslate nohighlight">
\[s = \left( \frac{ \left&lt; vol \right&gt; } {vol} \right)^\frac{1}{3}\]</div>
</section>
<section id="Temperature-equilibration-stage">
<h5>Temperature equilibration stage<a class="headerlink" href="#Temperature-equilibration-stage" title="Permalink to this heading">¶</a></h5>
<p>The temperature equilibration stage runs nvt at the target temperature for the system fixed at the computed average volume. This allows for the system to equilibrate at the fixed volume and target temperature, and to compute a target total energy, <span class="math notranslate nohighlight">\(E_{target}\)</span>, that corresponds to the system in equilibrium at the target temperature. <span class="math notranslate nohighlight">\(E_{target}\)</span> is computed based on time-averaged energy values from a specified number of samples (temprelaxsamples) taken every 100 timesteps from the
end of this stage. The max value allowed for temprelaxsamples is temprelaxsteps / 100. Unlike the previous stage, the equilibration portion of this stage is likely negligible, therefore it is less important to ignore the initial measurements.</p>
<p>In LAMMPS, the adjustment is made by scaling all atomic velocities to a temperature <span class="math notranslate nohighlight">\(T_s\)</span> such that the current potential energy, <span class="math notranslate nohighlight">\(E_{pot}\)</span>, plus the kinetic energy for <span class="math notranslate nohighlight">\(T_s\)</span> equals <span class="math notranslate nohighlight">\(E_{target}\)</span></p>
<div class="math notranslate nohighlight">
\[E_{target} = E_{pot} + \frac{3}{2} N k_B T_s\]</div>
<div class="math notranslate nohighlight">
\[T_s = \frac{2 \left( E_{target} - E_{pot} \right)}{3 N k_B}\]</div>
<p>Two alternate methods for computing <span class="math notranslate nohighlight">\(E_{target}\)</span> are implemented and can be accessed with the temprelaxstyle option.</p>
<ul class="simple">
<li><p>For temprelaxstyle = ‘te’, the target total energy is taken as the computed mean total energy</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E_{target} = \left&lt; E_{total}\right&gt;\]</div>
<ul class="simple">
<li><p>For temprelaxstyle = ‘pe’, the target total energy is taken as the computed mean potential energy plus kinetic energy for the target temperature, <span class="math notranslate nohighlight">\(T\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[E_{target} = \left&lt; E_{pot} \right&gt; + \frac{3}{2} N k_B T\]</div>
<p>Limited tests show the two methods to result in mean temperatures in the final stage that have roughly the same variation from the target temperature, with ‘pe’ style giving slightly better results. As such, both methods are included as options and ‘pe’ is set as the default.</p>
</section>
<section id="Analysis-stage">
<h5>Analysis stage<a class="headerlink" href="#Analysis-stage" title="Permalink to this heading">¶</a></h5>
<p>The analysis stage runs nve with the system that has been adjusted to the target volume and total energy from the last two stages. During this stage, mean squared displacements and radial distribution function calculations are performed that can be used to analyze the liquid phase at the target temperature and pressure.</p>
<p>In addition to the analysis calculations, the average measured temperature and pressure are reported, which can be used as verification that the volume and temperature equilibration stages and adjustments worked properly.</p>
</section>
</section>
</div>
</div>
</section>
</section>
<section id="2.-Define-calculation-functions-and-generate-files">
<h2>2. Define calculation functions and generate files<a class="headerlink" href="#2.-Define-calculation-functions-and-generate-files" title="Permalink to this heading">¶</a></h2>
<p>This section defines the calculation functions and associated resource files exactly as they exist inside the iprPy package. This allows for the code used to be directly visible and modifiable by anyone looking to see how it works.</p>
<section id="2.1.-relax_liquid()">
<h3>2.1. relax_liquid()<a class="headerlink" href="#2.1.-relax_liquid()" title="Permalink to this heading">¶</a></h3>
<p>This is the primary function for the calculation. The version of this function built in iprPy can be accessed by calling the calc() method of an object of the associated calculation class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">relax_liquid</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">system</span><span class="p">:</span> <span class="n">am</span><span class="o">.</span><span class="n">System</span><span class="p">,</span>
                 <span class="n">potential</span><span class="p">:</span> <span class="n">lmp</span><span class="o">.</span><span class="n">Potential</span><span class="p">,</span>
                 <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">mpi_command</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">temperature_melt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3000.0</span><span class="p">,</span>
                 <span class="n">meltsteps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
                 <span class="n">coolsteps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
                 <span class="n">volrelaxsteps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
                 <span class="n">volrelaxsamples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
                 <span class="n">temprelaxsteps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
                 <span class="n">temprelaxsamples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                 <span class="n">temprelaxstyle</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;pe&#39;</span><span class="p">,</span>
                 <span class="n">runsteps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
                 <span class="n">dumpsteps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">createvelocities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">randomseed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs a multi-stage simulation to obtain a liquid phase configuration</span>
<span class="sd">    at a given temperature. Radial displacement functions and mean squared</span>
<span class="sd">    displacements are automatically computed for the system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lammps_command :str</span>
<span class="sd">        Command for running LAMMPS.</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to perform the calculation on.</span>
<span class="sd">    potential : atomman.lammps.Potential</span>
<span class="sd">        The LAMMPS implemented potential to use.</span>
<span class="sd">    temperature : float</span>
<span class="sd">        The target temperature to relax to.</span>
<span class="sd">    mpi_command : str, optional</span>
<span class="sd">        The MPI command for running LAMMPS in parallel.  If not given, LAMMPS</span>
<span class="sd">        will run serially.</span>
<span class="sd">    pressure : float, optional</span>
<span class="sd">        The target hydrostatic pressure to relax to. Default value is 0. GPa.</span>
<span class="sd">    temperature_melt : float, optional</span>
<span class="sd">        The elevated temperature to first use to hopefully melt the initial</span>
<span class="sd">        configuration.</span>
<span class="sd">    meltsteps : int, optional</span>
<span class="sd">        The number of npt integration steps to perform at the melt temperature</span>
<span class="sd">        to create an amorphous liquid structure.  Default value is 50000.</span>
<span class="sd">    coolsteps : int, optional</span>
<span class="sd">        The number of npt integration steps to perform to reduce the</span>
<span class="sd">        temperature from the melt temperature to the target temperature.</span>
<span class="sd">        Default value is 10000.</span>
<span class="sd">    volrelaxsteps : int, optional</span>
<span class="sd">        The number of npt integration steps to perform on the amorphous</span>
<span class="sd">        structure at the target temperature and pressure to obtain the</span>
<span class="sd">        equilibrium volume.  Default value is 50000.</span>
<span class="sd">    volrelaxsamples : int, optional</span>
<span class="sd">        The number of thermo samples from the end of the volume relax stage</span>
<span class="sd">        to use in computing the average volume.  Cannot be larger than</span>
<span class="sd">        volrelaxsteps / 100.  It is recommended to set smaller than the max</span>
<span class="sd">        to allow for some convergence time.  Default value is 300.</span>
<span class="sd">    temprelaxsteps : int, optional</span>
<span class="sd">        The number of nvt integration steps to perform on the system at</span>
<span class="sd">        the target temperature after scaling to the average equilibrium</span>
<span class="sd">        volume.  Default value is 10000.</span>
<span class="sd">    temprelaxsamples : int, optional</span>
<span class="sd">        The number of thermo samples from the end of the temperature relax</span>
<span class="sd">        stage to use in computing the target total energy.  Cannot be</span>
<span class="sd">        larger than temprelaxsteps / 100.  Default value is 100.</span>
<span class="sd">    temprelaxstyle : str, optional</span>
<span class="sd">        Indicates which scheme to use for computing the target total energy.</span>
<span class="sd">        Allowed values are &#39;pe&#39; or &#39;te&#39;.  For &#39;te&#39;, the average total energy</span>
<span class="sd">        from the temprelaxsamples is used as the target energy.  For &#39;pe&#39;,</span>
<span class="sd">        the average potential energy plus 3/2 N kB T is used as the target</span>
<span class="sd">        energy.  Default value is &#39;pe&#39;.</span>
<span class="sd">    runsteps : int or None, optional</span>
<span class="sd">        The number of nve integration steps to perform on the system to</span>
<span class="sd">        obtain measurements of MSD and RDF of the liquid. Default value is</span>
<span class="sd">        50000.</span>
<span class="sd">    dumpsteps : int or None, optional</span>
<span class="sd">        Dump files will be saved every this many steps during the runsteps</span>
<span class="sd">        simulation. Default is None, which sets dumpsteps equal to runsteps.</span>
<span class="sd">    createvelocities : bool, optional</span>
<span class="sd">        If True (default), velocities will be created for the atoms prior to</span>
<span class="sd">        running the simulations.  Setting this to False can be useful if the</span>
<span class="sd">        initial system already has velocity information.</span>
<span class="sd">    randomseed : int or None, optional</span>
<span class="sd">        Random number seed used by LAMMPS in creating velocities and with</span>
<span class="sd">        the Langevin thermostat.  Default is None which will select a</span>
<span class="sd">        random int between 1 and 900000000.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of results consisting of keys:</span>

<span class="sd">        - **&#39;dumpfile_final&#39;** (*str*) - The name of the final dump file</span>
<span class="sd">          created.</span>
<span class="sd">        - **&#39;symbols_final&#39;** (*list*) - The symbols associated with the final</span>
<span class="sd">          dump file.</span>
<span class="sd">        - **&#39;volume&#39;** (*float*) - The volume per atom identified after the volume</span>
<span class="sd">          equilibration stage.</span>
<span class="sd">        - **&#39;volume_stderr&#39;** (*float*) - The standard error in the volume per atom</span>
<span class="sd">          measured during the volume equilibration stage.</span>
<span class="sd">        - **&#39;E_total&#39;** (*float*) - The total energy of the system used during the nve</span>
<span class="sd">          stage.</span>
<span class="sd">        - **&#39;E_total_stderr&#39;** (*float*) - The standard error in the mean total energy</span>
<span class="sd">          computed during the energy equilibration stage.</span>
<span class="sd">        - **&#39;E_pot&#39;** (*float*) - The mean measured potential energy during the energy</span>
<span class="sd">          equilibration stage.</span>
<span class="sd">        - **&#39;E_pot_stderr&#39;** (*float*) - The standard error in the mean potential energy</span>
<span class="sd">          during the energy equilibration stage.</span>
<span class="sd">        - **&#39;measured_temp&#39;** (*float*) - The mean measured temperature during the nve</span>
<span class="sd">          stage.</span>
<span class="sd">        - **&#39;measured_temp_stderr&#39;** (*float*) - The standard error in the measured</span>
<span class="sd">          temperature values of the nve stage.</span>
<span class="sd">        - **&#39;measured_press&#39;** (*float*) - The mean measured pressure during the nve</span>
<span class="sd">          stage.</span>
<span class="sd">        - **&#39;measured_press_stderr&#39;** (*float*) - The standard error in the measured</span>
<span class="sd">          pressure values of the nve stage.</span>
<span class="sd">        - **&#39;time_values&#39;** (*numpy.array of float*) - The values of time that</span>
<span class="sd">          correspond to the mean squared displacement values.</span>
<span class="sd">        - **&#39;msd_x_values&#39;** (*numpy.array of float*) - The mean squared displacement</span>
<span class="sd">          values only in the x direction.</span>
<span class="sd">        - **&#39;msd_y_values&#39;** (*numpy.array of float*) - The mean squared displacement</span>
<span class="sd">         values only in the y direction.</span>
<span class="sd">        - **&#39;msd_z_values&#39;** (*numpy.array of float*) - The mean squared displacement</span>
<span class="sd">         values only in the z direction.</span>
<span class="sd">        - **&#39;msd_values&#39;** (*numpy.array of float*) - The total mean squared</span>
<span class="sd">           displacement values.</span>
<span class="sd">        - **&#39;lammps_output&#39;** (*atomman.lammps.Log*) - The LAMMPS logfile output.</span>
<span class="sd">          Can be useful for checking the thermo data at each simulation stage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">temprelaxstyle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pe&#39;</span><span class="p">,</span> <span class="s1">&#39;te&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid temprelaxstyle option: must be &quot;pe&quot; or &quot;te&quot;&#39;</span><span class="p">)</span>

    <span class="c1"># Get lammps units</span>
    <span class="n">lammps_units</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">unit</span><span class="p">(</span><span class="n">potential</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

    <span class="c1">#Get lammps version date</span>
    <span class="n">lammps_date</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">checkversion</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>

    <span class="c1"># Handle default values</span>
    <span class="k">if</span> <span class="n">dumpsteps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dumpsteps</span> <span class="o">=</span> <span class="n">runsteps</span>

    <span class="c1"># Check volrelax and temprelax settings</span>
    <span class="k">if</span> <span class="n">volrelaxsamples</span> <span class="o">&gt;</span> <span class="n">volrelaxsteps</span> <span class="o">/</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid values: volrelaxsamples must be &lt;= volrelaxsteps / 100&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temprelaxsamples</span> <span class="o">&gt;</span> <span class="n">temprelaxsteps</span> <span class="o">/</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid values: temprelaxsamples must be &lt;= temprelaxsteps / 100&#39;</span><span class="p">)</span>

    <span class="c1"># Define lammps variables</span>
    <span class="n">lammps_variables</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;boltzmann&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">uc</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="s1">&#39;kB&#39;</span><span class="p">],</span>
                                                    <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>

    <span class="c1"># Dump initial system as data and build LAMMPS inputs</span>
    <span class="n">system_info</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;atom_data&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s1">&#39;init.dat&#39;</span><span class="p">,</span>
                              <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">)</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;atomman_system_pair_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_info</span>

    <span class="c1"># Phase settings</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;temperature_melt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature_melt</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressure</span>

    <span class="c1"># Set timestep dependent parameters</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">timestep</span><span class="p">(</span><span class="n">potential</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestep</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;temperature_damp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">timestep</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;pressure_damp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">timestep</span>

    <span class="c1"># Number of run/dump steps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;meltsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meltsteps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;coolsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coolsteps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;volrelaxsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volrelaxsteps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;temprelaxsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temprelaxsteps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;runsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runsteps</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dumpsteps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dumpsteps</span>

    <span class="c1"># Number of samples</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;volrelaxsamples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volrelaxsamples</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;temprelaxsamples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temprelaxsamples</span>

    <span class="c1"># Set randomseed</span>
    <span class="k">if</span> <span class="n">randomseed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">randomseed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">900000000</span><span class="p">)</span>
    <span class="c1">#lammps_variables[&#39;randomseed&#39;] = randomseed</span>

    <span class="c1"># create velocities</span>
    <span class="k">if</span> <span class="n">createvelocities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">meltsteps</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">coolsteps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">velocity_temp</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">velocity_temp</span> <span class="o">=</span> <span class="n">temperature_melt</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;create_velocities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;velocity all create </span><span class="si">{</span><span class="n">velocity_temp</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">randomseed</span><span class="si">}</span><span class="s1"> mom yes rot yes dist gaussian&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;create_velocities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Set dump_keys based on atom_style</span>
    <span class="k">if</span> <span class="n">potential</span><span class="o">.</span><span class="n">atom_style</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]:</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_keys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;id type q xu yu zu c_pe vx vy vz&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_keys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;id type xu yu zu c_pe vx vy vz&#39;</span>

    <span class="c1"># Set dump_modify_format based on lammps_date</span>
    <span class="k">if</span> <span class="n">lammps_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">potential</span><span class="o">.</span><span class="n">atom_style</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]:</span>
            <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_modify_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;%d %d</span><span class="si">{</span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s2">&quot; </span><span class="si">%.13e</span><span class="s2">&quot;</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_modify_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;%d %d</span><span class="si">{</span><span class="mi">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s2">&quot; </span><span class="si">%.13e</span><span class="s2">&quot;</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_modify_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;float </span><span class="si">%.13e</span><span class="s1">&#39;</span>

    <span class="c1"># Write lammps input script</span>
    <span class="n">lammps_script</span> <span class="o">=</span> <span class="s1">&#39;liquid.in&#39;</span>
    <span class="n">lammps_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;liquid_ave_</span><span class="si">{</span><span class="n">temprelaxstyle</span><span class="si">}</span><span class="s1">.template&#39;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">read_calc_file</span><span class="p">(</span><span class="s1">&#39;iprPy.calculation.relax_liquid&#39;</span><span class="p">,</span> <span class="n">lammps_template</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filltemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">lammps_variables</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">))</span>

    <span class="c1"># Run lammps</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">script_name</span><span class="o">=</span><span class="n">lammps_script</span><span class="p">,</span>
                     <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Extract LAMMPS thermo data.</span>
    <span class="c1">#thermo_melt = output.simulations[0].thermo</span>
    <span class="c1">#thermo_cool = output.simulations[1].thermo</span>
    <span class="n">thermo_vol_equil</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span>
    <span class="n">thermo_temp_equil</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span>
    <span class="n">thermo_nve</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Set final dumpfile info</span>
    <span class="n">last_dump_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">thermo_nve</span><span class="o">.</span><span class="n">Step</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">.dump&#39;</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;dumpfile_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_dump_file</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;symbols_final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">symbols</span>

    <span class="n">natoms</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">natoms</span>

    <span class="c1"># Get equilibrated volume</span>
    <span class="n">volume_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">^3&quot;</span>
    <span class="n">samplestart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thermo_vol_equil</span><span class="p">)</span> <span class="o">-</span> <span class="n">volrelaxsamples</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_temp_equil</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">volume_unit</span><span class="p">)</span> <span class="o">/</span> <span class="n">natoms</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;volume_stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_vol_equil</span><span class="o">.</span><span class="n">Volume</span><span class="p">[</span><span class="n">samplestart</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">volume_unit</span><span class="p">)</span> <span class="o">/</span> <span class="n">natoms</span> <span class="o">/</span> <span class="p">(</span><span class="n">volrelaxsamples</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Get equilibrated energies</span>
    <span class="n">samplestart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thermo_temp_equil</span><span class="p">)</span> <span class="o">-</span> <span class="n">temprelaxsamples</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_nve</span><span class="o">.</span><span class="n">TotEng</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">natoms</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_total_stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_temp_equil</span><span class="o">.</span><span class="n">TotEng</span><span class="p">[</span><span class="n">samplestart</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">natoms</span> <span class="o">/</span> <span class="p">(</span><span class="n">temprelaxsamples</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_temp_equil</span><span class="o">.</span><span class="n">PotEng</span><span class="p">[</span><span class="n">samplestart</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">natoms</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;E_pot_stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_temp_equil</span><span class="o">.</span><span class="n">PotEng</span><span class="p">[</span><span class="n">samplestart</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">natoms</span> <span class="o">/</span> <span class="p">(</span><span class="n">temprelaxsamples</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Get measured temperature and pressure during the nve run</span>
    <span class="n">nsamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thermo_nve</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;measured_temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thermo_nve</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;measured_temp_stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thermo_nve</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">nsamples</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="p">(</span><span class="n">thermo_nve</span><span class="o">.</span><span class="n">Pxx</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">thermo_nve</span><span class="o">.</span><span class="n">Pyy</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">thermo_nve</span><span class="o">.</span><span class="n">Pzz</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;measured_press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">pressure</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;measured_press_stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">pressure</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">nsamples</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Get MSD values</span>
    <span class="n">msd_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">^2&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">thermo_nve</span><span class="o">.</span><span class="n">Step</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">thermo_nve</span><span class="o">.</span><span class="n">Step</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">timestep</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;time_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;msd_x_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_nve</span><span class="p">[</span><span class="s1">&#39;c_msd[1]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">msd_unit</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;msd_y_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_nve</span><span class="p">[</span><span class="s1">&#39;c_msd[2]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">msd_unit</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;msd_z_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_nve</span><span class="p">[</span><span class="s1">&#39;c_msd[3]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">msd_unit</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;msd_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo_nve</span><span class="p">[</span><span class="s1">&#39;c_msd[4]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">msd_unit</span><span class="p">)</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;lammps_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</section>
<section id="2.2.-liquid_ave_pe.template-file">
<h3>2.2. liquid_ave_pe.template file<a class="headerlink" href="#2.2.-liquid_ave_pe.template-file" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;liquid_ave_pe.template&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;# LAMMPS input script that performs a liquid phase relaxation and evaluation</span>

<span class="s2">box tilt large</span>

<span class="s2">&lt;atomman_system_pair_info&gt;</span>

<span class="s2">change_box all triclinic</span>

<span class="s2">timestep &lt;timestep&gt;</span>

<span class="s2"># Define variables for box volume</span>
<span class="s2">variable vol equal vol</span>
<span class="s2">fix ave_vol all ave/time 100 1 100 v_vol ave window &lt;volrelaxsamples&gt;</span>
<span class="s2">variable ave_vol equal f_ave_vol</span>

<span class="s2"># Define thermo for relax stages</span>
<span class="s2">thermo 100</span>
<span class="s2">thermo_style custom step temp pe ke etotal pxx pyy pzz lx ly lz vol f_ave_vol</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span>

<span class="s2">&lt;create_velocities&gt;</span>

<span class="s2">################################## Melt ############################</span>

<span class="s2">fix npt all npt temp &lt;temperature_melt&gt; &lt;temperature_melt&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;meltsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2">######################### Scale to temperature ####################</span>

<span class="s2">fix npt all npt temp &lt;temperature_melt&gt; &lt;temperature&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;coolsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2">####################### Equilibrate volume #######################</span>

<span class="s2">fix npt all npt temp &lt;temperature&gt; &lt;temperature&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;volrelaxsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2"># Scale box dimensions according to last computed average volume</span>
<span class="s2">variable scale equal ($</span><span class="si">{ave_vol}</span><span class="s2">/$</span><span class="si">{vol}</span><span class="s2">)^(1/3)</span>
<span class="s2">variable slx equal $</span><span class="si">{scale}</span><span class="s2">*lx</span>
<span class="s2">variable sly equal $</span><span class="si">{scale}</span><span class="s2">*ly</span>
<span class="s2">variable slz equal $</span><span class="si">{scale}</span><span class="s2">*lz</span>
<span class="s2">variable sxy equal $</span><span class="si">{scale}</span><span class="s2">*xy</span>
<span class="s2">variable sxz equal $</span><span class="si">{scale}</span><span class="s2">*xz</span>
<span class="s2">variable syz equal $</span><span class="si">{scale}</span><span class="s2">*yz</span>
<span class="s2">change_box all x final 0.0 $</span><span class="si">{slx}</span><span class="s2"> y final 0.0 $</span><span class="si">{sly}</span><span class="s2"> z final 0.0 $</span><span class="si">{slz}</span><span class="s2"> xy final $</span><span class="si">{sxy}</span><span class="s2"> xz final $</span><span class="si">{sxz}</span><span class="s2"> yz final $</span><span class="si">{syz}</span><span class="s2"> remap units box</span>

<span class="s2">####################### Equilibrate energy #######################</span>

<span class="s2"># Compute average potential energy over the nvt run</span>
<span class="s2">variable pe equal pe</span>
<span class="s2">fix ave_pe all ave/time 100 1 100 v_pe ave running</span>

<span class="s2"># Perform an nvt run at target dimensions</span>
<span class="s2">fix nvt all nvt temp &lt;temperature&gt; &lt;temperature&gt; &lt;temperature_damp&gt;</span>
<span class="s2">run &lt;temprelaxsteps&gt;</span>
<span class="s2">unfix nvt</span>

<span class="s2"># Compute temperature to scale velocities to achieve target etotal</span>
<span class="s2">variable kB equal &lt;boltzmann&gt;</span>
<span class="s2">variable etotal_scale equal f_ave_pe+(3/2)*atoms*v_kB*&lt;temperature&gt;</span>
<span class="s2">variable temperature_scale equal 2*(v_etotal_scale-pe)/(3*atoms*v_kB)</span>

<span class="s2"># Scale last velocities to temperature_scale</span>
<span class="s2">print &quot;Scaling to target etotal using temperature = $</span><span class="si">{temperature_scale}</span><span class="s2">&quot;</span>
<span class="s2">velocity all scale $</span><span class="si">{temperature_scale}</span>
<span class="s2">unfix ave_pe</span>

<span class="s2">###################### NVE analysis run ########################</span>

<span class="s2"># Set up analysis computes</span>
<span class="s2">compute pe all pe/atom</span>
<span class="s2">compute msd all msd com yes</span>
<span class="s2">compute rdf all rdf 100</span>
<span class="s2">fix 1 all ave/time 100 1 100 c_rdf[*] file rdf.txt mode vector</span>

<span class="s2"># Dump configurations</span>
<span class="s2">dump dumpit all custom &lt;dumpsteps&gt; *.dump &lt;dump_keys&gt;</span>
<span class="s2">dump_modify dumpit format &lt;dump_modify_format&gt;</span>

<span class="s2"># Change thermo to report msd</span>
<span class="s2">thermo 100</span>
<span class="s2">thermo_style custom step temp pe ke etotal pxx pyy pzz c_msd[1] c_msd[2] c_msd[3] c_msd[4]</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span>

<span class="s2">fix nve all nve</span>
<span class="s2">run &lt;runsteps&gt;&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.3.-liquid_ave_te.template-file">
<h3>2.3. liquid_ave_te.template file<a class="headerlink" href="#2.3.-liquid_ave_te.template-file" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;liquid_ave_te.template&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;# LAMMPS input script that performs a liquid phase relaxation and evaluation</span>

<span class="s2">box tilt large</span>

<span class="s2">&lt;atomman_system_pair_info&gt;</span>

<span class="s2">change_box all triclinic</span>

<span class="s2">timestep &lt;timestep&gt;</span>

<span class="s2"># Define variables for box volume</span>
<span class="s2">variable vol equal vol</span>
<span class="s2">fix ave_vol all ave/time 100 1 100 v_vol ave window &lt;volrelaxsamples&gt;</span>
<span class="s2">variable ave_vol equal f_ave_vol</span>

<span class="s2"># Define thermo for relax stages</span>
<span class="s2">thermo 100</span>
<span class="s2">thermo_style custom step temp pe ke etotal pxx pyy pzz lx ly lz vol f_ave_vol</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span>

<span class="s2">&lt;create_velocities&gt;</span>

<span class="s2">################################## Melt ############################</span>

<span class="s2">fix npt all npt temp &lt;temperature_melt&gt; &lt;temperature_melt&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;meltsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2">######################### Scale to temperature ####################</span>

<span class="s2">fix npt all npt temp &lt;temperature_melt&gt; &lt;temperature&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;coolsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2">####################### Equilibrate volume #######################</span>

<span class="s2">fix npt all npt temp &lt;temperature&gt; &lt;temperature&gt; &lt;temperature_damp&gt; aniso &lt;pressure&gt; &lt;pressure&gt; &lt;pressure_damp&gt;</span>
<span class="s2">run &lt;volrelaxsteps&gt;</span>
<span class="s2">unfix npt</span>

<span class="s2"># Scale box dimensions according to last computed average volume</span>
<span class="s2">variable scale equal ($</span><span class="si">{ave_vol}</span><span class="s2">/$</span><span class="si">{vol}</span><span class="s2">)^(1/3)</span>
<span class="s2">variable slx equal $</span><span class="si">{scale}</span><span class="s2">*lx</span>
<span class="s2">variable sly equal $</span><span class="si">{scale}</span><span class="s2">*ly</span>
<span class="s2">variable slz equal $</span><span class="si">{scale}</span><span class="s2">*lz</span>
<span class="s2">variable sxy equal $</span><span class="si">{scale}</span><span class="s2">*xy</span>
<span class="s2">variable sxz equal $</span><span class="si">{scale}</span><span class="s2">*xz</span>
<span class="s2">variable syz equal $</span><span class="si">{scale}</span><span class="s2">*yz</span>
<span class="s2">change_box all x final 0.0 $</span><span class="si">{slx}</span><span class="s2"> y final 0.0 $</span><span class="si">{sly}</span><span class="s2"> z final 0.0 $</span><span class="si">{slz}</span><span class="s2"> xy final $</span><span class="si">{sxy}</span><span class="s2"> xz final $</span><span class="si">{sxz}</span><span class="s2"> yz final $</span><span class="si">{syz}</span><span class="s2"> remap units box</span>

<span class="s2">####################### Equilibrate energy #######################</span>

<span class="s2"># Compute average total energy over the nvt run</span>
<span class="s2">variable etotal equal etotal</span>
<span class="s2">fix ave_etotal all ave/time 100 1 100 v_etotal ave window &lt;temprelaxsamples&gt;</span>

<span class="s2"># Perform an nvt run at target dimensions</span>
<span class="s2">fix nvt all nvt temp &lt;temperature&gt; &lt;temperature&gt; &lt;temperature_damp&gt;</span>
<span class="s2">run &lt;temprelaxsteps&gt;</span>
<span class="s2">unfix nvt</span>

<span class="s2"># Compute temperature to scale velocities to achieve target etotal</span>
<span class="s2">variable kB equal &lt;boltzmann&gt;</span>
<span class="s2">variable temperature_scale equal 2*(f_ave_etotal-pe)/(3*atoms*v_kB)</span>

<span class="s2"># Scale last velocities to temperature_scale</span>
<span class="s2">print &quot;Scaling to target etotal using temperature = $</span><span class="si">{temperature_scale}</span><span class="s2">&quot;</span>
<span class="s2">velocity all scale $</span><span class="si">{temperature_scale}</span>
<span class="s2">unfix ave_etotal</span>

<span class="s2">###################### NVE analysis run ########################</span>

<span class="s2"># Set up analysis computes</span>
<span class="s2">compute pe all pe/atom</span>
<span class="s2">compute msd all msd com yes</span>
<span class="s2">compute rdf all rdf 100</span>
<span class="s2">fix 1 all ave/time 100 1 100 c_rdf[*] file rdf.txt mode vector</span>

<span class="s2"># Dump configurations</span>
<span class="s2">dump dumpit all custom &lt;dumpsteps&gt; *.dump &lt;dump_keys&gt;</span>
<span class="s2">dump_modify dumpit format &lt;dump_modify_format&gt;</span>

<span class="s2"># Change thermo to report msd</span>
<span class="s2">thermo 100</span>
<span class="s2">thermo_style custom step temp pe ke etotal pxx pyy pzz c_msd[1] c_msd[2] c_msd[3] c_msd[4]</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span>

<span class="s2">fix nve all nve</span>
<span class="s2">run &lt;runsteps&gt;&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="3.-Specify-input-parameters">
<h2>3. Specify input parameters<a class="headerlink" href="#3.-Specify-input-parameters" title="Permalink to this heading">¶</a></h2>
<section id="3.1.-System-specific-paths">
<h3>3.1. System-specific paths<a class="headerlink" href="#3.1.-System-specific-paths" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>lammps_command</strong> is the LAMMPS command to use (required).</p></li>
<li><p><strong>mpi_command</strong> MPI command for running LAMMPS in parallel. A value of None will run simulations serially.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;lmp&#39;</span>
<span class="n">mpi_command</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Optional: check that LAMMPS works and show its version</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LAMMPS version = </span><span class="si">{</span><span class="n">am</span><span class="o">.</span><span class="n">lammps</span><span class="o">.</span><span class="n">checkversion</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="3.2.-Interatomic-potential">
<h3>3.2. Interatomic potential<a class="headerlink" href="#3.2.-Interatomic-potential" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>potential_name</strong> gives the name of the potential_LAMMPS reference record in the iprPy library to use for the calculation.</p></li>
<li><p><strong>potential</strong> is an atomman.lammps.Potential object (required).</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_name</span> <span class="o">=</span> <span class="s1">&#39;1999--Mishin-Y--Ni--LAMMPS--ipr1&#39;</span>

<span class="c1"># Retrieve potential and parameter file(s) using atomman</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load_lammps_potential</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">potential_name</span><span class="p">,</span> <span class="n">getfiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="3.3.-Initial-unit-cell-system">
<h3>3.3. Initial unit cell system<a class="headerlink" href="#3.3.-Initial-unit-cell-system" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>ucell</strong> is an atomman.System representing a fundamental unit cell of the system (required). Here, this is generated using the load parameters and symbols.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create ucell by loading prototype record</span>
<span class="n">ucell</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;prototype&#39;</span><span class="p">,</span> <span class="s1">&#39;A1--Cu--fcc&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
avect =  [ 3.500,  0.000,  0.000]
bvect =  [ 0.000,  3.500,  0.000]
cvect =  [ 0.000,  0.000,  3.500]
origin = [ 0.000,  0.000,  0.000]
natoms = 4
natypes = 1
symbols = (&#39;Ni&#39;,)
pbc = [ True  True  True]
per-atom properties = [&#39;atype&#39;, &#39;pos&#39;]
     id |   atype |  pos[0] |  pos[1] |  pos[2]
      0 |       1 |   0.000 |   0.000 |   0.000
      1 |       1 |   0.000 |   1.750 |   1.750
      2 |       1 |   1.750 |   0.000 |   1.750
      3 |       1 |   1.750 |   1.750 |   0.000
</pre></div></div>
</div>
</section>
<section id="3.4.-System-modifications">
<h3>3.4. System modifications<a class="headerlink" href="#3.4.-System-modifications" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>sizemults</strong> list of three integers specifying how many times the ucell vectors of <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(c\)</span> are replicated in creating system.</p></li>
<li><p><strong>system</strong> is an atomman.System to perform the scan on (required).</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sizemults</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="c1"># Generate system by supersizing ucell</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ucell</span><span class="o">.</span><span class="n">supersize</span><span class="p">(</span><span class="o">*</span><span class="n">sizemults</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of atoms in system =&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">natoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# of atoms in system = 4000
</pre></div></div>
</div>
</section>
<section id="3.5.-Calculation-specific-parameters">
<h3>3.5. Calculation-specific parameters<a class="headerlink" href="#3.5.-Calculation-specific-parameters" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>pressure</strong> gives the hydrostatic pressure to equilibriate the system to.</p></li>
<li><p><strong>temperature</strong> gives the temperature to equilibriate the system to.</p></li>
<li><p><strong>temperature_melt</strong> gives the temperature to use during the melt stage.</p></li>
<li><p><strong>meltsteps</strong> gives the number of MD steps to perform during the melt stage.</p></li>
<li><p><strong>coolsteps</strong> gives the number of MD steps to perform during the cooling stage.</p></li>
<li><p><strong>volrelaxsteps</strong> gives the number of MD steps to perform during the volume equilibration stage.</p></li>
<li><p><strong>volrelaxsamples</strong> gives the number of thermo samples to use in estimating the average volume during the volume equilibration phase. Must be &lt;= volrelaxsteps / 100.</p></li>
<li><p><strong>temprelaxsteps</strong> gives the number of MD steps to perform during the temperature equilibration stage.</p></li>
<li><p><strong>temprelaxsamples</strong> gives the number of thermo samples to use in estimating the average potential energy during the temperature equilibration phase. Must be &lt;= temprelaxsteps / 100.</p></li>
<li><p><strong>runsteps</strong> gives the number of MD steps to perform during the nve analysis stage.</p></li>
<li><p><strong>dumpsteps</strong> gives the number of MD steps that atomic configurations are to be dumped during the nve analysis stage. If None, will be set to runsteps.</p></li>
<li><p><strong>createvelocities</strong> indicates if atomic velocities will be created for all atoms before any of the simulations. Only set to False if the system already has atomic velocities and you wish to use those.</p></li>
<li><p><strong>randomseed</strong> gives an integer random number generator seed. Setting this to None will randomly pick a number.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pressure</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="mf">1500.0</span>
<span class="n">temperature_melt</span> <span class="o">=</span> <span class="mf">3000.0</span>
<span class="n">meltsteps</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">coolsteps</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">volrelaxsteps</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">volrelaxsamples</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">temprelaxsteps</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">temprelaxsamples</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">runsteps</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">dumpsteps</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">createvelocities</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">randomseed</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="4.-Run-calculation-and-view-results">
<h2>4. Run calculation and view results<a class="headerlink" href="#4.-Run-calculation-and-view-results" title="Permalink to this heading">¶</a></h2>
<section id="4.1.-Run-calculation">
<h3>4.1. Run calculation<a class="headerlink" href="#4.1.-Run-calculation" title="Permalink to this heading">¶</a></h3>
<p>All primary calculation method functions take a series of inputs and return a dictionary of outputs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="n">relax_liquid</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span>
                            <span class="n">mpi_command</span> <span class="o">=</span> <span class="n">mpi_command</span><span class="p">,</span>
                            <span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">,</span>
                            <span class="n">temperature_melt</span> <span class="o">=</span> <span class="n">temperature_melt</span><span class="p">,</span>
                            <span class="n">meltsteps</span> <span class="o">=</span> <span class="n">meltsteps</span><span class="p">,</span>
                            <span class="n">coolsteps</span> <span class="o">=</span> <span class="n">coolsteps</span><span class="p">,</span>
                            <span class="n">volrelaxsteps</span> <span class="o">=</span> <span class="n">volrelaxsteps</span><span class="p">,</span>
                            <span class="n">volrelaxsamples</span> <span class="o">=</span> <span class="n">volrelaxsamples</span><span class="p">,</span>
                            <span class="n">temprelaxsteps</span> <span class="o">=</span> <span class="n">temprelaxsteps</span><span class="p">,</span>
                            <span class="n">temprelaxsamples</span> <span class="o">=</span> <span class="n">temprelaxsamples</span><span class="p">,</span>
                            <span class="n">runsteps</span> <span class="o">=</span> <span class="n">runsteps</span><span class="p">,</span>
                            <span class="n">dumpsteps</span> <span class="o">=</span> <span class="n">dumpsteps</span><span class="p">,</span>
                            <span class="n">createvelocities</span> <span class="o">=</span> <span class="n">createvelocities</span><span class="p">,</span>
                            <span class="n">randomseed</span> <span class="o">=</span> <span class="n">randomseed</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;dumpfile_final&#39;, &#39;symbols_final&#39;, &#39;volume&#39;, &#39;volume_stderr&#39;, &#39;E_total&#39;, &#39;E_total_stderr&#39;, &#39;E_pot&#39;, &#39;E_pot_stderr&#39;, &#39;measured_temp&#39;, &#39;measured_temp_stderr&#39;, &#39;measured_press&#39;, &#39;measured_press_stderr&#39;, &#39;time_values&#39;, &#39;msd_x_values&#39;, &#39;msd_y_values&#39;, &#39;msd_z_values&#39;, &#39;msd_values&#39;, &#39;lammps_output&#39;])
</pre></div></div>
</div>
</section>
<section id="4.2.-Report-results">
<h3>4.2. Report results<a class="headerlink" href="#4.2.-Report-results" title="Permalink to this heading">¶</a></h3>
<p>Values returned in the results_dict:</p>
<ul class="simple">
<li><p><strong>‘dumpfile_final’</strong> (<em>str</em>) - The name of the final dump file created.</p></li>
<li><p><strong>‘symbols_final’</strong> (<em>list</em>) - The symbols associated with the final dump file.</p></li>
<li><p><strong>‘volume’</strong> (<em>float</em>) - The mean volume per atom measured for the liquid.</p></li>
<li><p><strong>‘volume_stderr’</strong> (<em>float</em>) - The standard error in the volume per atom measured during the npt run at the target temperature.</p></li>
<li><p><strong>‘measured_temp’</strong> (<em>float</em>) - The mean measured temperature during the nve run.</p></li>
<li><p><strong>‘measured_temp_stderr’</strong> (<em>float</em>) - The standard error in the measured temperature values of the nve run.</p></li>
<li><p><strong>‘measured_press’</strong> (<em>float</em>) - The mean measured pressure during the nve run.</p></li>
<li><p><strong>‘measured_press_stderr’</strong> (<em>float</em>) - The standard error in the measured pressure values of the nve run.</p></li>
<li><p><strong>‘time_values’</strong> (<em>numpy.array of float</em>) - The values of time that correspond to the mean squared displacement values.</p></li>
<li><p><strong>‘msd_x_values’</strong> (<em>numpy.array of float</em>) - The mean squared displacement values only in the x direction.</p></li>
<li><p><strong>‘msd_y_values’</strong> (<em>numpy.array of float</em>) - The mean squared displacement values only in the y direction.</p></li>
<li><p><strong>‘msd_z_values’</strong> (<em>numpy.array of float</em>) - The mean squared displacement values only in the z direction.</p></li>
<li><p><strong>‘msd_values’</strong> (<em>numpy.array of float</em>) - The total mean squared displacement values.</p></li>
<li><p><strong>‘lammps_output’</strong> (<em>atomman.lammps.Log</em>) - The LAMMPS logfile output. Can be useful for checking the thermo data at each simulation stage.</p></li>
</ul>
<section id="4.2.1.-Final-configuration-is-saved-in-the-following-file">
<h4>4.2.1. Final configuration is saved in the following file<a class="headerlink" href="#4.2.1.-Final-configuration-is-saved-in-the-following-file" title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;final dump file:&#39;</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile_final&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;use symbols:&#39;</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;symbols_final&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
final dump file: 170000.dump
use symbols: (&#39;Ni&#39;,)
</pre></div></div>
</div>
</section>
<section id="4.2.2.-Show-the-measured-phase-state-and-standard-errors-computed-during-the-volume-equilibration-and-nve-stages.">
<h4>4.2.2. Show the measured phase state and standard errors computed during the volume equilibration and nve stages.<a class="headerlink" href="#4.2.2.-Show-the-measured-phase-state-and-standard-errors-computed-during-the-volume-equilibration-and-nve-stages." title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">length_unit</span> <span class="o">=</span> <span class="s1">&#39;angstrom&#39;</span>
<span class="n">pressure_unit</span> <span class="o">=</span> <span class="s1">&#39;GPa&#39;</span>
<span class="n">volume_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">length_unit</span><span class="si">}</span><span class="s1">^3&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The measured phase state:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;volume / atom =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="n">volume_unit</span><span class="p">),</span>
      <span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;volume_stderr&#39;</span><span class="p">],</span> <span class="n">volume_unit</span><span class="p">),</span> <span class="n">volume_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature =&#39;</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_temp&#39;</span><span class="p">],</span> <span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_temp_stderr&#39;</span><span class="p">],</span> <span class="s1">&#39;K&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pressure =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_press&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span>
      <span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;measured_press_stderr&#39;</span><span class="p">],</span> <span class="n">pressure_unit</span><span class="p">),</span> <span class="n">pressure_unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The measured phase state:
volume / atom = 12.137390541532001 +- 0.0012818909048845622 angstrom^3
temperature = 1503.8037660952825 +- 0.6679224452193951 K
pressure = 0.04942618661668862 +- 0.00391230335932846 GPa
</pre></div></div>
</div>
</section>
<section id="4.2.3.-Show-the-energy-estimates-and-standard-errors-computed-during-the-energy-equilibration-stage.">
<h4>4.2.3. Show the energy estimates and standard errors computed during the energy equilibration stage.<a class="headerlink" href="#4.2.3.-Show-the-energy-estimates-and-standard-errors-computed-during-the-energy-equilibration-stage." title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_unit</span> <span class="o">=</span> <span class="s1">&#39;eV&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E_total / atom =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_total&#39;</span><span class="p">],</span> <span class="n">energy_unit</span><span class="p">),</span>
      <span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_total_stderr&#39;</span><span class="p">],</span> <span class="n">energy_unit</span><span class="p">),</span> <span class="n">energy_unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E_pot / atom =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_pot&#39;</span><span class="p">],</span> <span class="n">energy_unit</span><span class="p">),</span>
      <span class="s1">&#39;+-&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_pot_stderr&#39;</span><span class="p">],</span> <span class="n">energy_unit</span><span class="p">),</span> <span class="n">energy_unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
E_total / atom = -3.8588477904765 +- 0.0003603650346919358 eV
E_pot / atom = -4.0527141435573055 +- 0.00025333082486368806 eV
</pre></div></div>
</div>
</section>
<section id="4.2.4.-Plot-mean-squared-displacement">
<h4>4.2.4. Plot mean squared displacement<a class="headerlink" href="#4.2.4.-Plot-mean-squared-displacement" title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">length_unit</span><span class="si">}</span><span class="s1">^2&#39;</span>
<span class="n">time_unit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;time_values&#39;</span><span class="p">],</span> <span class="n">time_unit</span><span class="p">)</span>
<span class="n">msd_x</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;msd_x_values&#39;</span><span class="p">],</span> <span class="n">area_unit</span><span class="p">)</span>
<span class="n">msd_y</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;msd_y_values&#39;</span><span class="p">],</span> <span class="n">area_unit</span><span class="p">)</span>
<span class="n">msd_z</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;msd_z_values&#39;</span><span class="p">],</span> <span class="n">area_unit</span><span class="p">)</span>
<span class="n">msd</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;msd_values&#39;</span><span class="p">],</span> <span class="n">area_unit</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;One-dimensional mean squared displacements&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time (</span><span class="si">{</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MSD (</span><span class="si">{</span><span class="n">area_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">msd_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">msd_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">msd_z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Three-dimensional mean squared displacements&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time (</span><span class="si">{</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MSD (</span><span class="si">{</span><span class="n">area_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">msd</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_35_0.png" src="../_images/notebook_relax_liquid_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_35_1.png" src="../_images/notebook_relax_liquid_35_1.png" />
</div>
</div>
</section>
</section>
<section id="4.3.-Plot-radial-distribution-function">
<h3>4.3. Plot radial distribution function<a class="headerlink" href="#4.3.-Plot-radial-distribution-function" title="Permalink to this heading">¶</a></h3>
<p>Radial distribution results are saved to the file rdf.txt. The class defined below will read the file and make plotting easy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atomman.tools</span> <span class="kn">import</span> <span class="n">uber_open_rmode</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">class</span> <span class="nc">RDF</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for interpreting LAMMPS rdf (radial distribution function) output files&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdf_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">rdf_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rdf_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdf_file</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">numvals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">timeheader</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">with</span> <span class="n">uber_open_rmode</span><span class="p">(</span><span class="n">rdf_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">rdf_data</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rdf_data</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">timeheader</span><span class="p">:</span>
                    <span class="n">terms</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">timestep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">numvals</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="c1"># initialize data for the timestep</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">numvals</span><span class="p">),</span>
                                                       <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">numvals</span><span class="p">),</span>
                                                       <span class="s1">&#39;coord&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">numvals</span><span class="p">)})</span>
                    <span class="n">timeheader</span> <span class="o">+=</span> <span class="n">numvals</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">terms</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;coord&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdf</span> <span class="o">=</span> <span class="n">RDF</span><span class="p">(</span><span class="s1">&#39;rdf.txt&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Radial distribution function&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r (angstroms)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;g(r)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">timeseries</span> <span class="ow">in</span> <span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timeseries</span><span class="p">]</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timeseries</span><span class="p">]</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coordination function&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r (angstroms)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;coord(r)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">timeseries</span> <span class="ow">in</span> <span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timeseries</span><span class="p">]</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">rdf</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">timeseries</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_38_0.png" src="../_images/notebook_relax_liquid_38_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_38_1.png" src="../_images/notebook_relax_liquid_38_1.png" />
</div>
</div>
</section>
<section id="4.4.-Look-at-simulation-thermo-results-in-the-log.lammps-file">
<h3>4.4. Look at simulation thermo results in the log.lammps file<a class="headerlink" href="#4.4.-Look-at-simulation-thermo-results-in-the-log.lammps-file" title="Permalink to this heading">¶</a></h3>
<p>This is a complex calculation with many components. It can be useful to check the reported thermo values of some of the earlier stages to ensure that the individual stages behaved properly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The log content can be directly accessed when the calculation is done in a Python environment</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;lammps_output&#39;</span><span class="p">]</span>

<span class="c1"># Or, read the info in from the log file...</span>
<span class="c1">#log = am.lammps.Log(&#39;log.lammps&#39;)</span>
</pre></div>
</div>
</div>
<section id="4.4.1.-Check-Melt-stage">
<h4>4.4.1. Check Melt stage<a class="headerlink" href="#4.4.1.-Check-Melt-stage" title="Permalink to this heading">¶</a></h4>
<p>A quick check of volume and box dimensions during the melt stage can help reveal if the system has transformed into a liquid.</p>
<ul class="simple">
<li><p>The measured volume should converge to a constant value.</p></li>
<li><p>The measured box dimensions should <em>not</em> converge to constant values.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Volume per atom during melt stage&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;MD step&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volume (angstroms^3)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Volume</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Box dimensions during melt stage&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;MD step&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Box length (angstroms^3)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Lx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Ly</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ly&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Lz</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_42_0.png" src="../_images/notebook_relax_liquid_42_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_42_1.png" src="../_images/notebook_relax_liquid_42_1.png" />
</div>
</div>
</section>
<section id="4.4.2.-Volume-equilibration-stage">
<h4>4.4.2. Volume equilibration stage<a class="headerlink" href="#4.4.2.-Volume-equilibration-stage" title="Permalink to this heading">¶</a></h4>
<p>Also important is to check that the measured volume and time averaged volumes are converging appropriately for the volume equilibration stage. Note that only the last time-averaged value is used to adjust the system dimensions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot volume and average volume during the volume equilibrate stage to check convergence</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Volume per atom during volume equilibration stage&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;MD step&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volume (angstroms^3)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Volume</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;measured&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">f_ave_vol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;time-averaged&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_relax_liquid_44_0.png" src="../_images/notebook_relax_liquid_44_0.png" />
</div>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">relax_liquid - Methodology and code</a><ul>
<li><a class="reference internal" href="#1.-Load-calculation-and-view-description">1. Load calculation and view description</a><ul>
<li><a class="reference internal" href="#1.1.-Load-the-calculation">1.1. Load the calculation</a></li>
<li><a class="reference internal" href="#1.2.-Display-calculation-description-and-theory">1.2. Display calculation description and theory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Define-calculation-functions-and-generate-files">2. Define calculation functions and generate files</a><ul>
<li><a class="reference internal" href="#2.1.-relax_liquid()">2.1. relax_liquid()</a></li>
<li><a class="reference internal" href="#2.2.-liquid_ave_pe.template-file">2.2. liquid_ave_pe.template file</a></li>
<li><a class="reference internal" href="#2.3.-liquid_ave_te.template-file">2.3. liquid_ave_te.template file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Specify-input-parameters">3. Specify input parameters</a><ul>
<li><a class="reference internal" href="#3.1.-System-specific-paths">3.1. System-specific paths</a></li>
<li><a class="reference internal" href="#3.2.-Interatomic-potential">3.2. Interatomic potential</a></li>
<li><a class="reference internal" href="#3.3.-Initial-unit-cell-system">3.3. Initial unit cell system</a></li>
<li><a class="reference internal" href="#3.4.-System-modifications">3.4. System modifications</a></li>
<li><a class="reference internal" href="#3.5.-Calculation-specific-parameters">3.5. Calculation-specific parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4.-Run-calculation-and-view-results">4. Run calculation and view results</a><ul>
<li><a class="reference internal" href="#4.1.-Run-calculation">4.1. Run calculation</a></li>
<li><a class="reference internal" href="#4.2.-Report-results">4.2. Report results</a><ul>
<li><a class="reference internal" href="#4.2.1.-Final-configuration-is-saved-in-the-following-file">4.2.1. Final configuration is saved in the following file</a></li>
<li><a class="reference internal" href="#4.2.2.-Show-the-measured-phase-state-and-standard-errors-computed-during-the-volume-equilibration-and-nve-stages.">4.2.2. Show the measured phase state and standard errors computed during the volume equilibration and nve stages.</a></li>
<li><a class="reference internal" href="#4.2.3.-Show-the-energy-estimates-and-standard-errors-computed-during-the-energy-equilibration-stage.">4.2.3. Show the energy estimates and standard errors computed during the energy equilibration stage.</a></li>
<li><a class="reference internal" href="#4.2.4.-Plot-mean-squared-displacement">4.2.4. Plot mean squared displacement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4.3.-Plot-radial-distribution-function">4.3. Plot radial distribution function</a></li>
<li><a class="reference internal" href="#4.4.-Look-at-simulation-thermo-results-in-the-log.lammps-file">4.4. Look at simulation thermo results in the log.lammps file</a><ul>
<li><a class="reference internal" href="#4.4.1.-Check-Melt-stage">4.4.1. Check Melt stage</a></li>
<li><a class="reference internal" href="#4.4.2.-Volume-equilibration-stage">4.4.2. Volume equilibration stage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="relax_dynamic.html"
                          title="previous chapter">relax_dynamic - Methodology and code</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="relax_static.html"
                          title="next chapter">relax_static - Methodology and code</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="relax_static.html" title="relax_static - Methodology and code"
             >next</a> |</li>
        <li class="right" >
          <a href="relax_dynamic.html" title="relax_dynamic - Methodology and code"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" >Jupyter Demonstration Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">relax_liquid - Methodology and code</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.1.
    </div>
  </body>
</html>