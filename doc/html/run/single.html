
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Running a single calculation &#8212; iprPy 0.11.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Run a Jupyter Calculation Notebook" href="notebook.html" />
    <link rel="prev" title="Calculations" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="notebook.html" title="Run a Jupyter Calculation Notebook"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Calculations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Calculations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running a single calculation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="running-a-single-calculation">
<h1>Running a single calculation<a class="headerlink" href="#running-a-single-calculation" title="Permalink to this headline">¶</a></h1>
<p>This page outlines the general steps associated with setting up and running a
single calculation.  The general order of these steps holds true regardless of
if you are only working with command line and text files or are running in a
Python environment.  As such, the various alternate ways of accessing the steps
are described together.</p>
<p><strong>NOTE:</strong> In the descriptions below, the commands will be used relative to the
“isolated_atom” calculation style.  To use any other calculation style, simply
replace “isolated_atom” with another calculation style.</p>
<div class="section" id="check-available-calculations">
<h2>1. Check available calculations<a class="headerlink" href="#check-available-calculations" title="Permalink to this headline">¶</a></h2>
<p>The check_modules command will output information associated with which module
components of iprPy successfully loaded or encountered an issue.  This allows
for users to see which calculations are currently available and what additional
packages may be required in order to use some of the calculations.</p>
<div class="section" id="command-line">
<h3>1.1. Command line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy check_modules
</pre></div>
</div>
</div>
<div class="section" id="python">
<h3>1.2. Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">iprPy</span>
<span class="n">iprPy</span><span class="o">.</span><span class="n">check_modules</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-new-directory">
<h2>2. Create new directory<a class="headerlink" href="#create-new-directory" title="Permalink to this headline">¶</a></h2>
<p>It is recommended but not required that you create a new empty directory for
running the calculation.  This is because a number of files are created both in
setting up and performing the calculation and starting with a clean directory
will help keep things organized.</p>
</div>
<div class="section" id="check-a-calculation-s-documentation">
<h2>3. Check a calculation’s documentation<a class="headerlink" href="#check-a-calculation-s-documentation" title="Permalink to this headline">¶</a></h2>
<p>Each calculation has documentation broken into two major components: main
documentation and methods and theory.  The main documentation gives a general
overview of what the calculation does and who created it, while methods and
theory give a more detailed description of the underlying theory and how it is
implemented in the calculation’s code.  Note that all variations described
below are based on the same underlying documentation files and therefore should
be providing the same content.</p>
<div class="section" id="online">
<h3>3.1. Online<a class="headerlink" href="#online" title="Permalink to this headline">¶</a></h3>
<p>Each supported calculation style is described in the online documentation found
at <a class="reference external" href="https://www.ctcms.nist.gov/potentials/iprPy/calculation_styles.html">https://www.ctcms.nist.gov/potentials/iprPy/calculation_styles.html</a>.  There,
you can click on a specific style and see a small list. The first two bullets,
“Introduction” and “Method and Theory” link to the related web pages for the
two types of documentation.</p>
</div>
<div class="section" id="id1">
<h3>3.2. Command line<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy maindoc isolated_atom
$ iprPy theorydoc isolated_atom
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>3.3. Python<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calc</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">load_calculation</span><span class="p">(</span><span class="s1">&#39;isolated_atom&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">maindoc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">theorydoc</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are in a Jupyter or iPython environment, the raw markdown can be
automatically converted to pretty HTML</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">maindoc</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">theorydoc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="source-files">
<h3>3.4 Source files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h3>
<p>You can also view the documentation files directly if you have downloaded a
copy of the source code.  Inside iprPy/calculation are subdirectories for each
calculation style.  Each one of those then contains “README.md” and “theory.md”
files that contain the documentation.</p>
</div>
</div>
<div class="section" id="calculation-input-parameters">
<h2>4. Calculation input parameters<a class="headerlink" href="#calculation-input-parameters" title="Permalink to this headline">¶</a></h2>
<p>Each calculation has its own set of input parameters that it recognizes which
can be specified inside a text file consisting of key-value input command
lines.  The rules of the input parameter files are simple:</p>
<ul class="simple">
<li><p>Each line is treated independently and split into white-spaced delimited
terms.</p></li>
<li><p>Any terms listed after a “#” will be treated as comments and ignored.</p></li>
<li><p>The first term on any given line corresponds to a parameter name, i.e. a key.
Any other terms following it are interpreted as the value(s) to assign to
that parameter.</p></li>
<li><p>If only a parameter name appears on a line with no values (i.e. there is only
one term) then the line is ignored.</p></li>
<li><p>Each parameter can be assigned at most one set of values.  In other words,
there can only be one line per parameter name that has more than one term in
it.</p></li>
<li><p>Any parameters not assigned values will be given default values if the
calculation allows it or will issue an error for required parameters.</p></li>
</ul>
<div class="section" id="id3">
<h3>4.1. Command line<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The template command will create an empty version of a calculation’s input
script consisting of only the recognized parameter names and no values.  The
generated file will be named calc_&lt;calc_style&gt;.in and can be opened using any
text editor.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy template isolated_atom
</pre></div>
</div>
<p>A description of the terms in the input parameter file can be viewed using the
templatedoc command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy templatedoc isolated_atom
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>4.2. Python<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Similarly, the template and templatedoc content can be viewed from within
Python by using the template and templatedoc attributes of a Calculation
object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">templatedoc</span><span class="p">)</span>
</pre></div>
</div>
<p>or in Jupyter/iPython</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">templatedoc</span><span class="p">))</span>
</pre></div>
</div>
<p>If you wish, the input file content can alternately be specified as a Python
dict containing the parameter names and values to use.  This makes it possible
to run the calculation without needing to generate the input file.</p>
<p>Alternatively, the underlying calculation methods can be directly executed in
Python.  For each calculation class, the primary calculation function is
accessible by the calc() method.  The full docstring for that function can be
viewed in many Python editors or can be viewed with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<p>Currently, work is being done to support a more Pythonic approach to performing
the calculations in which all parameters can be directly set to a calculation
object as attributes prior to running.</p>
</div>
</div>
<div class="section" id="running-the-calculation">
<h2>5. Running the calculation<a class="headerlink" href="#running-the-calculation" title="Permalink to this headline">¶</a></h2>
<p>Once the calculation’s input values are set, you can run the calculation.</p>
<div class="section" id="id5">
<h3>5.1. Command line<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The run command will run the calculation using the input script you filled in.
If you used the default input script name (calc_&lt;calc_style&gt;.in) then you can
simply pass the input file in</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy run calc_isolated_atom.in
</pre></div>
</div>
<p>If you renamed the input file to something else, then you will also need to
specify the calculation style.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ iprPy run input_set_1.in isolated_atom
</pre></div>
</div>
<p>When the calculation finishes successfully, a <strong>record.json</strong> record file will
be created containing the processed results.  This can then be viewed in any
text editor or imported into any software that can interpret JSON.</p>
</div>
<div class="section" id="id6">
<h3>5.2. Python<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The Calculation classes contain a number of methods that allow for the
associated calculations to be performed.</p>
<ul class="simple">
<li><p><strong>run()</strong> is the primary method for running the calculation.  It will run the
calculation based on a provided input parameter file or dict, or based on the
input parameter attributes currently set to the Calculation object.  Upon
completion, the calculation results will be set as class attributes. A
“results.json” file can be automatically generated if requested.</p></li>
<li><p><strong>calc()</strong> is an alias for the underlying calculation function allowing for
it to be directly accessed and called.  This makes it possible to manually
set up the calculation’s inputs and work with the function itself.  When
completed, the function will return a Python dict containing computed
results terms.</p></li>
<li><p><strong>load_parameters()</strong> will read a input parameter file or dict and interpret
the provided values into attributes of the current Calculation object.  In
short, this interprets and manages the calculation’s inputs without running
it.</p></li>
<li><p><strong>process_results()</strong> takes the dict returned by calc() and interprets the
contained values into attributes of the current Calculation class.  This
makes the results directly accessible in a Pythonic way and allows for
analysis methods to be built into the Calculation classes themselves.  Note
that run() will automatically call this.</p></li>
<li><p><strong>build_model()</strong> will construct a JSON/XML equivalent data model based on
the Calculation object’s current set attributes.  This makes it possible to
generate JSON/XML records for a calculation both before and after it has been
ran.  Note that the required attributes will not be set if calc() is accessed
directly rather than using the other methods listed above.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">results_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or equivalently</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calc</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
<span class="n">calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">build_model</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>or (assuming lammps_command and potential are defined for the calculation)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">potential</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Running a single calculation</a><ul>
<li><a class="reference internal" href="#check-available-calculations">1. Check available calculations</a><ul>
<li><a class="reference internal" href="#command-line">1.1. Command line</a></li>
<li><a class="reference internal" href="#python">1.2. Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-new-directory">2. Create new directory</a></li>
<li><a class="reference internal" href="#check-a-calculation-s-documentation">3. Check a calculation’s documentation</a><ul>
<li><a class="reference internal" href="#online">3.1. Online</a></li>
<li><a class="reference internal" href="#id1">3.2. Command line</a></li>
<li><a class="reference internal" href="#id2">3.3. Python</a></li>
<li><a class="reference internal" href="#source-files">3.4 Source files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calculation-input-parameters">4. Calculation input parameters</a><ul>
<li><a class="reference internal" href="#id3">4.1. Command line</a></li>
<li><a class="reference internal" href="#id4">4.2. Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-calculation">5. Running the calculation</a><ul>
<li><a class="reference internal" href="#id5">5.1. Command line</a></li>
<li><a class="reference internal" href="#id6">5.2. Python</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Calculations</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="notebook.html"
                          title="next chapter">Run a Jupyter Calculation Notebook</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="notebook.html" title="Run a Jupyter Calculation Notebook"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Calculations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.11.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Calculations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running a single calculation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>